define(["jquery","../fn/defined","../fn/cre","plugins/bs-switch"],function(e,t,n){function i(r,i){var s=this;i=t(i)?i:{},this.options=_.merge(this.defaults,i),this.$el=r,this.$target=e(this.options.target),this.$hidden=n().addClass("hide").appendTo(e("body")),this.editables={},e.each(this.options.editables,function(e,t){s.editables[t.id]=t}),this.editableTargets={},this.$target.find("*[data-component-editor-id]").each(function(){var n=e(this),r=n.data("component-editor-id").split("|");e.each(r,function(e,r){t(s.editableTargets[r])?s.editableTargets[r]=s.editableTargets[r].add(n):s.editableTargets[r]=n}),console.log(r)}),this.createEditorPanel()}var r={select:function(t,r){var i=this,s=n("select").appendTo(r).addClass(i.options.controlClass).attr("data-component-editor-for-id",t.id);e.each(t.options,function(e,r){var i=n("option").attr("value",e).text(r.name);t.default===e&&i.attr("selected","selected"),s.append(i)}),s.on("change",function(){var t=e(this);console.log("selected new editable option",t.val());var n=t.data("component-editor-for-id"),r=i.editables[n];i.getTarget(n).removeClass(r.options[r.current].class).addClass(r.options[t.val()].class),i.setCurrent(n,t.val()),console.log("changed option for",n,r)}),i.setCurrent(t.id,t.default);var o=i.getTarget(t.id),u=t.options[t.default].class;return o.hasClass(u)||o.addClass(u),s},"switch":function(e,t){var r=this;return n("input").appendTo(t).attr({id:e.id,type:"checkbox","data-size":"mini","data-on-color":"warning"}).addClass("switch").bootstrapSwitch({state:e.default,onSwitchChange:function(t,n){console.log(t,n),e.options.toggle.apply(e.options)}})}};return i.prototype={constructor:i,defaults:{target:"",containerClass:"setting-box clearfix",labelWrapClass:"setting-label pull-left",labelClass:"control-label",controlWrapClass:"setting-control pull-right",controlClass:"form-control",editorTitle:"Editor",editables:[{id:"header",name:"Header class",type:"select","default":"",options:{}}]},createEditorPanel:function(){var t=this,i=t.$el,s=t.options;t.$form=n("form").appendTo(i),e.each(t.editables,function(e,i){var u=n().addClass(s.containerClass).appendTo(t.$form),a=n().addClass(s.labelWrapClass).appendTo(u),f=n().addClass(s.controlWrapClass).appendTo(u),l=n("label").addClass(t.options.labelClass).text(i.name).attr("for",i.id).appendTo(a),c=r[i.type].apply(t,[i,f])})},getEditable:function(e){return this.editables[e]},getTarget:function(e){return this.editableTargets[e]},getCurrent:function(e){return this.editables[e].current},setCurrent:function(e,t){this.editables[e].current=t}},i});