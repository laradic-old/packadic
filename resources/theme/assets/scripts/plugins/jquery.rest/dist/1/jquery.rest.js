(function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d;f=function(e){throw new Error("ERROR: jquery.rest: "+e)},c=function(e){var t;t="";while(e-->0)t+="  ";return t},a=function(t){return e.btoa||f("You need a polyfill for 'btoa' to use basic auth."),e.btoa(t)},h=function(t){return e.JSON||f("You need a polyfill for 'JSON' to use stringify."),e.JSON.stringify(t)},l=function(e,n){var r;return r=function(){},r.prototype=e,t.extend(!0,new r,n)},p=function(e){return!e||!t.isPlainObject(e)?!1:(t.each(e,function(e){if(o[e]===n)return f("Unknown option: '"+e+"'")}),null)},d=function(e,n){if("string"!==t.type(n))return f("'"+e+"' must be a string")},u=function(){return alert('"delete()" has been deprecated. Please use "destroy()" or "del()" instead.')},o={url:"",cache:0,request:function(e,n){return t.ajax(n)},isSingle:!1,autoClearCache:!0,cachableMethods:["GET"],methodOverride:!1,stringifyData:!1,stripTrailingSlash:!1,password:null,username:null,verbs:{create:"POST",read:"GET",update:"PUT",destroy:"DELETE"},ajax:{dataType:"json"}},r=function(){function e(e){this.parent=e,this.c={}}return e.prototype.valid=function(e){var t;return t=(new Date).getTime()-e.getTime(),t<=this.parent.opts.cache*1e3},e.prototype.key=function(e){var n,r=this;return n="",t.each(e,function(e,i){return n+=e+"="+(t.isPlainObject(i)?"{"+r.key(i)+"}":i)+"|"}),n},e.prototype.get=function(e){var t;t=this.c[e];if(!t)return;if(this.valid(t.created))return t.data},e.prototype.put=function(e,t){return this.c[e]={created:new Date,data:t}},e.prototype.clear=function(e){var n=this;return e?t.each(this.c,function(t){if(t.match(e))return delete n.c[t]}):this.c={}},e}(),s=function(){function e(e,n,r,i){this.name=e,this.method=n,r==null&&(r={}),this.parent=i,d("name",this.name),d("method",this.method),p(r),this.parent[this.name]&&f("Cannot add Verb: '"+e+"' already exists"),this.method=n.toUpperCase(),r.url||(r.url=""),this.opts=l(this.parent.opts,r),this.root=this.parent.root,this.custom=!o.verbs[this.name],this.call=t.proxy(this.call,this),this.call.instance=this}return e.prototype.call=function(){var e,t,n;return n=this.parent.extractUrlData(this.method,arguments),t=n.url,e=n.data,this.custom&&(t+=this.opts.url||this.name),this.parent.ajax.call(this,this.method,t,e)},e.prototype.show=function(e){return console.log(c(e)+this.name+": "+this.method)},e}(),i=function(){function e(t,n,r){n==null&&(n={}),p(n),r&&r instanceof e?(this.name=t,d("name",this.name),this.constructChild(r,n)):(this.url=t||"",d("url",this.url),this.constructRoot(n))}return e.prototype.constructRoot=function(e){return this.opts=l(o,e),this.root=this,this.expectedIds=0,this.urlNoId=this.url,this.cache=new r(this),this.parent=null,this.name=this.opts.name||"ROOT"},e.prototype.constructChild=function(n,r){this.parent=n,d("name",this.name),this.parent instanceof e||this.error("Invalid parent"),this.parent[this.name]&&this.error("'"+name+"' already exists"),r.url||(r.url=""),this.opts=l(this.parent.opts,r),this.opts.isSingle="isSingle"in r&&r.isSingle,this.root=this.parent.root,this.urlNoId=this.parent.url+(""+(this.opts.url||this.name)+"/"),this.url=this.urlNoId,this.expectedIds=this.parent.expectedIds,this.opts.isSingle||(this.expectedIds+=1,this.url+=":ID_"+this.expectedIds+"/"),t.each(this.opts.verbs,t.proxy(this.addVerb,this));if(this.destroy)return this.del=this.destroy,this["delete"]=u},e.prototype.error=function(e){return f("Cannot add Resource: "+e)},e.prototype.add=function(t,n){return this[t]=new e(t,n,this)},e.prototype.addVerb=function(e,t,n){return this[e]=(new s(e,t,n,this)).call},e.prototype.show=function(n){return n==null&&(n=0),n>25&&f("Plugin Bug! Recursion Fail"),this.name&&console.log(c(n)+this.name+": "+this.url),t.each(this,function(e,r){if(t.type(r)==="function"&&r.instance instanceof s&&e!=="del")return r.instance.show(n+1)}),t.each(this,function(t,r){if(t!=="parent"&&t!=="root"&&r instanceof e)return r.show(n+1)}),null},e.prototype.toString=function(){return this.name},e.prototype.extractUrlData=function(e,n){var r,i,s,o,u,a,l,c,h,p,d,v,m,g,y,b;l=[],o=null,h=null;for(m=0,y=n.length;m<y;m++)r=n[m],d=t.type(r),d==="string"||d==="number"?l.push(r):d==="object"&&o===null?o=r:d==="object"&&h===null?h=r:f("Invalid argument: "+r+" ("+d+")."+" Must be strings or ints (IDs) followed by one optional object and one optional query params object.");p=l.length,i=e!=="create",s=e!=="update"&&e!=="delete",v=null,i&&p===this.expectedIds&&(v=this.url),s&&p===this.expectedIds-1&&(v=this.urlNoId),v===null&&(s&&(c=this.expectedIds-1),i&&(c=(c?c+" or ":"")+this.expectedIds),f("Invalid number of ID arguments, required "+c+", provided "+p));for(u=g=0,b=l.length;g<b;u=++g)a=l[u],v=v.replace(new RegExp("/:ID_"+(u+1)+"/"),"/"+a+"/");return h&&(v+="?"+t.param(h)),{url:v,data:o}},e.prototype.ajax=function(e,n,r){var i,s,o,u,l,c,p,d=this;e||f("method missing"),n||f("url missing"),u={},this.opts.username&&this.opts.password&&(s=a(this.opts.username+":"+this.opts.password),u.Authorization="Basic "+s),r&&this.opts.stringifyData&&e!=="GET"&&e!=="HEAD"&&(r=h(r),u["Content-Type"]="application/json"),this.opts.methodOverride&&e!=="GET"&&e!=="HEAD"&&e!=="POST"&&(u["X-HTTP-Method-Override"]=e,e="POST"),this.opts.stripTrailingSlash&&(n=n.replace(/\/$/,"")),i={url:n,type:e,headers:u},r&&(i.data=r),i=t.extend(!0,{},this.opts.ajax,i),p=this.opts.cache&&t.inArray(e,this.opts.cachableMethods)>=0;if(p){l=this.root.cache.key(i),c=this.root.cache.get(l);if(c)return c}return this.opts.cache&&this.opts.autoClearCache&&t.inArray(e,this.opts.cachableMethods)===-1&&(o=n.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),this.root.cache.clear(new RegExp(o))),c=this.opts.request(this.parent,i),p&&c.done(function(){return d.root.cache.put(l,c)}),c},e}(),i.defaults=o,t.RestClient=i}).call(this,window,jQuery);