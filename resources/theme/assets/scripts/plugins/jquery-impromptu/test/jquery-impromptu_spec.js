describe("jquery-impromptu",function(){describe("base structure",function(){describe("basic initialization",function(){beforeEach(function(){$.fx.off=!0}),afterEach(function(){$.prompt.close()}),it("should be defined",function(){expect($.prompt).not.toBeUndefined()}),it("should generate markup",function(){var e="This is a title",t="This is a test";$.prompt(t,{title:e}),expect($(".jqibox")).toExist(),expect($(".jqifade")).toExist(),expect($(".jqi")).toExist(),expect($(".jqi .jqititle")).toHaveText(e),expect($(".jqi .jqimessage")).toHaveText(t)})}),describe("instance initialization",function(){var e=new Impromptu;beforeEach(function(){$.fx.off=!0}),afterEach(function(){e.close()}),it("should be defined",function(){expect(e).not.toBeUndefined()}),it("should generate markup",function(){var t="This is a title",n="This is a test";e.open(n,{title:t}),expect($(".jqibox")).toExist(),expect($(".jqifade")).toExist(),expect($(".jqi")).toExist(),expect($(".jqi .jqititle")).toHaveText(t),expect($(".jqi .jqimessage")).toHaveText(n)})}),describe("button creation",function(){beforeEach(function(){$.fx.off=!0}),afterEach(function(){$.prompt.close()}),it("should generate buttons from hash",function(){$.prompt("This is a test",{buttons:{Ok:!0,Cancel:!1}});var e=$('button[name="jqi_state0_buttonOk"]'),t=$('button[name="jqi_state0_buttonCancel"]');expect($(".jqibutton")).toHaveLength(2),expect(e).toExist(),expect(t).toExist(),expect(e).toHaveText("Ok"),expect(t).toHaveText("Cancel"),expect(e).toHaveValue("true"),expect(t).toHaveValue("false")}),it("should generate buttons from array",function(){$.prompt("This is a test",{buttons:[{title:"Ok",value:!0},{title:"Cancel",value:!1}]});var e=$('button[name="jqi_state0_buttonOk"]'),t=$('button[name="jqi_state0_buttonCancel"]');expect($(".jqibutton")).toHaveLength(2),expect(e).toExist(),expect(t).toExist(),expect(e).toHaveText("Ok"),expect(t).toHaveText("Cancel"),expect(e.val()).toBe("true"),expect(t.val()).toBe("false")}),it("should add classes to buttons",function(){$.prompt("This is a test",{buttons:[{title:"Ok",value:!0,classes:["ok1","ok2"]},{title:"Cancel",value:!1,classes:"cancel1 cancel2"}]});var e=$('button[name="jqi_state0_buttonOk"]'),t=$('button[name="jqi_state0_buttonCancel"]');expect(e).toHaveClass("ok1"),expect(e).toHaveClass("ok2"),expect(t).toHaveClass("cancel1"),expect(t).toHaveClass("cancel2")}),it("should add classes to buttons from classes obj",function(){$.prompt("This is a test",{buttons:[{title:"Ok",value:!0,classes:["ok1","ok2"]},{title:"Cancel",value:!1,classes:"cancel1 cancel2"}],classes:{button:"testclass"}});var e=$('button[name="jqi_state0_buttonOk"]'),t=$('button[name="jqi_state0_buttonCancel"]');expect(e).toHaveClass("testclass"),expect(t).toHaveClass("testclass")}),it("should default correct button",function(){$.prompt("This is a test",{buttons:[{title:"Ok",value:1},{title:"Cancel",value:2},{title:"Another",value:3}],focus:1});var e=$('button[name="jqi_state0_buttonOk"]'),t=$('button[name="jqi_state0_buttonCancel"]'),n=$('button[name="jqi_state0_buttonAnother"]');expect(e).not.toHaveClass("jqidefaultbutton"),expect(t).toHaveClass("jqidefaultbutton"),expect(n).not.toHaveClass("jqidefaultbutton")}),it("should default correct button when focus on an input",function(){$.prompt('This is a test <input type="text" id="testInput" />',{buttons:[{title:"Ok",value:1},{title:"Cancel",value:2},{title:"Another",value:3}],focus:"#testInput",defaultButton:1});var e=$('button[name="jqi_state0_buttonOk"]'),t=$('button[name="jqi_state0_buttonCancel"]'),n=$('button[name="jqi_state0_buttonAnother"]');expect(e).not.toHaveClass("jqidefaultbutton"),expect(t).toHaveClass("jqidefaultbutton"),expect(n).not.toHaveClass("jqidefaultbutton")})}),describe("state creation",function(){beforeEach(function(){$.fx.off=!0}),afterEach(function(){$.prompt.close()}),it("should create a single state from string",function(){$.prompt("This is a test"),expect($(".jqistate")).toExist()}),it("should create states from hash",function(){var e={s1:{html:"state 1"},s2:{html:"state 2"},s3:{html:"state 3"}};$.prompt(e),expect($(".jqistate")).toHaveLength(3),expect($('.jqistate[data-jqi-name="s1"] .jqimessage')).toHaveText(e.s1.html),expect($('.jqistate[data-jqi-name="s2"] .jqimessage')).toHaveText(e.s2.html),expect($('.jqistate[data-jqi-name="s3"] .jqimessage')).toHaveText(e.s3.html)}),it("should create states from array",function(){var e=[{html:"state 1"},{html:"state 2"},{html:"state 3"}];$.prompt(e),expect($(".jqistate")).toHaveLength(3),expect($('.jqistate[data-jqi-name="0"] .jqimessage')).toHaveText(e[0].html),expect($('.jqistate[data-jqi-name="1"] .jqimessage')).toHaveText(e[1].html),expect($('.jqistate[data-jqi-name="2"] .jqimessage')).toHaveText(e[2].html)}),it("should show the first state automatically",function(){var e=[{html:"state 1"},{html:"state 2"},{html:"state 3"}];$.prompt(e),expect($('.jqistate[data-jqi-name="0"]')).toHaveCss({display:"block"}),expect($('.jqistate[data-jqi-name="1"]')).toHaveCss({display:"none"}),expect($('.jqistate[data-jqi-name="2"]')).toHaveCss({display:"none"})}),it("should name states properly when name specified",function(){var e=[{name:"s1",html:"state 1"},{name:"s2",html:"state 2"},{name:"s3",html:"state 3"}];$.prompt(e),expect($('.jqistate[data-jqi-name="s1"]')).toExist(),expect($('.jqistate[data-jqi-name="s2"]')).toExist(),expect($('.jqistate[data-jqi-name="s3"]')).toExist()})})}),describe("api methods",function(){var e=[{name:"s1",html:"state 1"},{name:"s2",html:"state 2"},{name:"s3",html:"state 3"}];beforeEach(function(){$.fx.off=!0}),afterEach(function(){$.prompt.close()}),describe("static methods",function(){describe("$.prompt.setDefaults()",function(){it("should change the default values",function(){var e=$.extend(!0,{},Impromptu.defaults),t={prefix:"myjqi",classes:{box:"boxclass"}};$.prompt.setDefaults(t),expect(Impromptu.defaults.prefix).toBe(t.prefix),expect(Impromptu.defaults.classes.box).toBe(t.classes.box),expect(Impromptu.defaults.speed).toBe(e.speed),Impromptu.defaults=e})}),describe("$.prompt.setStateDefaults()",function(){it("should change the default state values",function(){var e=$.extend(!0,{},Impromptu.defaults),t={title:"My Title",position:{width:123}};$.prompt.setStateDefaults(t),expect(Impromptu.defaults.state.title).toBe(t.title),expect(Impromptu.defaults.state.position.width).toBe(t.position.width),expect(Impromptu.defaults.state.focus).toBe(e.state.focus),Impromptu.defaults=e})})}),describe("instance methods",function(){describe("$.prompt.getBox()",function(){it("should return the box jquery object",function(){$.prompt("This is a test");var e=$.prompt.getBox(),t=$(".jqibox");expect(e[0]).toBe(t[0])})}),describe("$.prompt.getPrompt()",function(){it("should return the prompt jquery object",function(){$.prompt("This is a test");var e=$.prompt.getPrompt(),t=$(".jqi");expect(e[0]).toBe(t[0])})}),describe("$.prompt.getState()",function(){it("should return the state jquery object",function(){$.prompt(e);var t=$.prompt.getState("s2"),n=$('.jqistate[data-jqi-name="s2"]');expect(t[0]).toBe(n[0])})}),describe("$.prompt.getCurrentState()",function(){it("should return the current state jquery object",function(){$.prompt(e);var t=$.prompt.getCurrentState(),n=$('.jqistate[data-jqi-name="s1"]');expect(t[0]).toBe(n[0])}),it("should return the current state jquery object after a state change",function(){$.prompt(e),$.prompt.goToState("s2");var t=$.prompt.getCurrentState(),n=$('.jqistate[data-jqi-name="s2"]');expect(t[0]).toBe(n[0])})}),describe("$.prompt.getCurrentStateName()",function(){it("should return the current state name",function(){$.prompt(e);var t=$.prompt.getCurrentStateName(),n="s1";expect(t).toBe(n)}),it("should return the current state name after a state change",function(){$.prompt(e),$.prompt.goToState("s2");var t=$.prompt.getCurrentStateName(),n="s2";expect(t).toBe(n)})}),describe("$.prompt.goToState()",function(){it("should make the requested state visible",function(){$.prompt(e),$.prompt.goToState("s3"),expect($('.jqistate[data-jqi-name="s1"]')).toHaveCss({display:"none"}),expect($('.jqistate[data-jqi-name="s2"]')).toHaveCss({display:"none"}),expect($('.jqistate[data-jqi-name="s3"]')).toHaveCss({display:"block"})}),it("should do nothing if the state is not available",function(){$.prompt(e),$.prompt.goToState("s4"),expect($('.jqistate[data-jqi-name="s1"]')).toHaveCss({display:"block"}),expect($('.jqistate[data-jqi-name="s2"]')).toHaveCss({display:"none"}),expect($('.jqistate[data-jqi-name="s3"]')).toHaveCss({display:"none"})}),it("should handle substate option",function(){$.prompt(e),$.prompt.goToState("s2",!0),expect($('.jqistate[data-jqi-name="s1"]')).toHaveCss({display:"block"}),expect($('.jqistate[data-jqi-name="s2"]')).toHaveCss({display:"block"}),expect($('.jqistate[data-jqi-name="s3"]')).toHaveCss({display:"none"}),expect($('.jqistate[data-jqi-name="s2"]')).toHaveClass("jqisubstate")})}),describe("$.prompt.nextState()",function(){it("should make the next state visible",function(){$.prompt(e),$.prompt.nextState(),expect($('.jqistate[data-jqi-name="s1"]')).toHaveCss({display:"none"}),expect($('.jqistate[data-jqi-name="s2"]')).toHaveCss({display:"block"}),expect($('.jqistate[data-jqi-name="s3"]')).toHaveCss({display:"none"})}),it("should do nothing if the state is not available",function(){$.prompt(e),$.prompt.goToState("s3"),$.prompt.nextState(),expect($('.jqistate[data-jqi-name="s1"]')).toHaveCss({display:"none"}),expect($('.jqistate[data-jqi-name="s2"]')).toHaveCss({display:"none"}),expect($('.jqistate[data-jqi-name="s3"]')).toHaveCss({display:"block"})})}),describe("$.prompt.prevState()",function(){it("should make the previous state visible",function(){$.prompt(e),$.prompt.goToState("s3"),$.prompt.prevState(),expect($('.jqistate[data-jqi-name="s1"]')).toHaveCss({display:"none"}),expect($('.jqistate[data-jqi-name="s2"]')).toHaveCss({display:"block"}),expect($('.jqistate[data-jqi-name="s3"]')).toHaveCss({display:"none"})}),it("should do nothing if the state is not available",function(){$.prompt(e),$.prompt.prevState(),expect($('.jqistate[data-jqi-name="s1"]')).toHaveCss({display:"block"}),expect($('.jqistate[data-jqi-name="s2"]')).toHaveCss({display:"none"}),expect($('.jqistate[data-jqi-name="s3"]')).toHaveCss({display:"none"})})}),describe("$.prompt.addState()",function(){it("should add a new state as the last state",function(){var t={name:"s4",title:"s4",html:"testing s4",buttons:{Ok:!0,Cancel:!1}};$.prompt(e);var n=$.prompt.addState(t.name,t);expect(n).toExist(),expect(n.prev().data("jqi-name")).toBe("s3"),expect($('.jqistate[data-jqi-name="s1"]')).toHaveCss({display:"block"}),expect(n).toHaveCss({display:"none"}),expect(n.find(".jqimessage")).toHaveText(t.html),expect(n.find(".jqititle")).toHaveText(t.title),expect(n.find(".jqibutton")).toHaveLength(2)}),it("should add a new state after specified state",function(){var t={name:"s4",title:"s4",html:"testing s4",buttons:{Ok:!0,Cancel:!1}},n="s2";$.prompt(e);var r=$.prompt.addState(t.name,t,n);expect(r.prev().data("jqi-name")).toBe(n)})}),describe("$.prompt.removeState()",function(){it("should remove the specified state",function(){$.prompt(e),$.prompt.removeState("s2"),expect($('.jqistate[data-jqi-name="s2"]')).not.toExist()}),it("should display requested state",function(){$.prompt(e),$.prompt.removeState("s1","s3"),expect($('.jqistate[data-jqi-name="s2"]')).toHaveCss({display:"none"}),expect($('.jqistate[data-jqi-name="s3"]')).toHaveCss({display:"block"})}),it("should display next state",function(){$.prompt(e),$.prompt.removeState("s1"),expect($('.jqistate[data-jqi-name="s2"]')).toHaveCss({display:"block"}),expect($('.jqistate[data-jqi-name="s3"]')).toHaveCss({display:"none"})}),it("should display previous state",function(){$.prompt(e),$.prompt.goToState("s3"),$.prompt.removeState("s3"),expect($('.jqistate[data-jqi-name="s1"]')).toHaveCss({display:"none"}),expect($('.jqistate[data-jqi-name="s2"]')).toHaveCss({display:"block"})})}),describe("$.prompt.close()",function(){it("should close the prompt",function(){$.prompt(e),$.prompt.close(),expect($(".jqibox")).not.toExist()})})})}),describe("api events",function(){var e=[{name:"s1",html:"state 1",buttons:{next:!0,cancel:!1}},{name:"s2",html:"state 2",buttons:{back:-1,cancel:0,next:1}},{name:"s3",html:"state 3",buttons:{done:!0}}];beforeEach(function(){$.fx.off=!0}),afterEach(function(){$.prompt.close(),$(".jqibox").remove()}),describe("impromptu:loaded",function(){describe("running through jquery event binding",function(){var t;beforeEach(function(n){t=!1,$("body").on("impromptu:loaded",".jqibox",function(){t=!0,n()}),$.prompt(e)}),it("should fire event",function(){expect(t).toBe(!0)})}),describe("passing loaded event through as option",function(){var t;beforeEach(function(n){t=!1,$.prompt(e,{loaded:function(){t=!0,n()}})}),it("should allow event function as option parameter",function(){expect(t).toBe(!0)})})}),describe("impromptu:close",function(){describe("running through jquery event binding",function(){var t;beforeEach(function(n){t=!1,$("body").on("impromptu:close",".jqibox",function(){t=!0,n()}),$.prompt(e,{loaded:function(){$.prompt.close()}})}),it("should fire event",function(){expect(t).toBe(!0)})}),describe("passing loaded event through as option",function(){var t;beforeEach(function(n){t=!1,$.prompt(e,{loaded:function(){$.prompt.close()},close:function(){t=!0,n()}})}),it("should allow event function as option parameter",function(){expect(t).toBe(!0)})})}),describe("impromptu:statechanging",function(){describe("running through jquery event binding",function(){var t;beforeEach(function(n){t=!1,$("body").on("impromptu:statechanging",".jqibox",function(){t=!0,n()}),$.prompt(e,{loaded:function(){$.prompt.goToState("s2")}})}),it("should fire event",function(){expect(t).toBe(!0)})}),describe("passing loaded event through as option",function(){var t;beforeEach(function(n){t=!1,$.prompt(e,{loaded:function(){$.prompt.goToState("s2")},statechanging:function(){t=!0,n()}})}),it("should allow event function as option parameter",function(){expect(t).toBe(!0)})}),it("should allow preventDefault",function(){var t=spyOnEvent("body","impromptu:statechanging");$.prompt(e,{loaded:function(){$.prompt.goToState("s2")},statechanging:function(e){e.preventDefault()}}),expect(t).toHaveBeenTriggered(),expect(t).toHaveBeenPrevented()})}),describe("impromptu:statechanged",function(){describe("running through jquery event binding",function(){var t;beforeEach(function(n){t=!1,$("body").on("impromptu:statechanged",".jqibox",function(){t=!0,n()}),$.prompt(e,{loaded:function(){$.prompt.goToState("s2")}})}),it("should fire event",function(){expect(t).toBe(!0)})}),describe("passing loaded event through as option",function(){var t;beforeEach(function(n){t=!1,$.prompt(e,{loaded:function(){$.prompt.goToState("s2")},statechanged:function(){t=!0,n()}})}),it("should allow event function as option parameter",function(){expect(t).toBe(!0)})})}),describe("impromptu:submit",function(){describe("running through jquery event binding",function(){var t;beforeEach(function(n){t=!1,$("body").on("impromptu:submit",".jqibox",function(){t=!0,n()}),$.prompt(e,{loaded:function(){$.prompt.getState("s1").find(".jqibutton:first").click()}})}),it("should fire event",function(){expect(t).toBe(!0)})}),describe("passing submit event through as option if string message",function(){var e;beforeEach(function(t){e=!1,$.prompt("Test message",{loaded:function(){$(".jqibutton:first").click()},submit:function(){e=!0,t()}})}),it("should allow event function as option parameter",function(){expect(e).toBe(!0)})}),describe("should detect button clicked",function(){var t,n,r;beforeEach(function(i){$("body").on("impromptu:submit",".jqibox",function(e,s,o,u){t=s,n=o,r=u,i()}),$.prompt(e,{loaded:function(){$.prompt.getState("s1").find('button[value="false"]').click()}})}),it("should detect button",function(){expect(t).toBe(!1)}),it("should pass the state message",function(){expect(n.is(".jqimessage")).toBe(!0)})}),describe("verifying form values",function(){var t=[],n,r,i,s={textInput:"my text input",selectSingle:"select single 3",selectMulti:["select multi 2","select multi 3"],radioInput:"my radio yes",chkInput:["my chk no","my chk maybe"],textareaInput:"my textarea val"};t[0]=$.extend({},e[0]),t[0].html='<input type="text" name="textInput" value="my text input" /><select name="selectSingle"><option value="select single 1">select single 1</option><option value="select single 2">select single 2</option><option value="select single 3" selected>select single 3</option></select><select name="selectMulti" multiple><option value="select multi1">select multi 1</option><option value="select multi 2" selected>select multi 2</option><option value="select multi 3" selected>select multi 3</option></select>',t[1]=$.extend({},e[1]),t[1].html='<input type="radio" name="radioInput" value="my radio yes" checked /><input type="radio" name="radioInput" value="my radio no" /><input type="checkbox" name="chkInput" value="my chk no" checked /><input type="checkbox" name="chkInput" value="my chk yes" /><input type="checkbox" name="chkInput" value="my chk maybe" checked />',t[3]=$.extend({},e[3]),t[3].html='<textarea name="textareaInput">my textarea val</textarea>',beforeEach(function(e){$("body").on("impromptu:submit",".jqibox",function(t,s,o,u){n=s,r=o,i=u,e()}),$.prompt(t,{loaded:function(){$.prompt.getState("s1").find('button[value="true"]').click()}})}),it("should pass the correct form values",function(){expect(i).toEqual(s)})})})}),describe("native events",function(){var e=[{name:"s1",html:"state 1",buttons:[{title:"One",value:1},{title:"Two",value:2},{title:"Three",value:3}],focus:1},{name:"s2",html:"state 2",buttons:{back:-1,cancel:0,next:1}},{name:"s3",html:"state 3",buttons:{done:!0}}];beforeEach(function(){$.fx.off=!0}),afterEach(function(){$.prompt.close()}),describe("keydown",function(){describe("on fade when persistent option true",function(){beforeEach(function(t){$.prompt(e,{loaded:function(){var e=$.Event("keydown");e.keyCode=27,$.prompt.getBox().trigger(e),t()},persistent:!0})}),it("should not close prompt",function(){expect($(".jqi")).toExist()})}),describe("on fade when persistent option false",function(){beforeEach(function(t){$.prompt(e,{loaded:function(){var e=$.Event("keydown");e.keyCode=27,$.prompt.getBox().trigger(e),t()},persistent:!1})}),it("should close prompt",function(){expect($(".jqi")).not.toExist()})}),describe("enter key in prompt",function(){var t=null;beforeEach(function(n){$("body").on("impromptu:submit",function(e,r){t=r,n()}),$.prompt(e,{loaded:function(){var e=$.Event("keydown");e.keyCode=13,$.prompt.getPrompt().trigger(e)}})}),it("should trigger click on the correct button",function(){expect(t).toBe(2)})})}),describe("click",function(){describe("fade click",function(){beforeEach(function(t){$.prompt(e,{loaded:function(){var e=$.Event("click");$.prompt.getBox().trigger(e),t()},persistent:!0})}),it("should not close fade if persistent option true",function(){expect($(".jqi")).toExist()})})})})});