var _=require("lodash"),fs=require("fs"),Q=require("q"),gulp=require("gulp"),autoprefixer=require("gulp-autoprefixer"),sass=require("gulp-sass"),del=require("del"),htmlDir="./examples",cssDir="./css",scssDir="./scss",htmlTmpl='<!DOCTYPE html>\n<html>\n<head>\n  <title><%= title %></title>\n  <style type="text/css">\n    <%= css %>\n  </style>\n</head>\n<body>\n <%= bodyContent %>\n</body>\n</html>',getHtmlUsageExample=function(e){return e.match(/Usage:([\s\S]+\*.+\>)/)[1].replace(/ \*/g,"")};gulp.task("clean-styles",function(e){del([cssDir],e)}),gulp.task("styles",["clean-styles"],function(){return gulp.src(scssDir+"/**/*.scss").pipe(sass({errLogToConsole:!0})).pipe(autoprefixer("last 2 versions",{map:!1})).pipe(gulp.dest(cssDir))}),gulp.task("clean-html",function(e){del([htmlDir],e)}),gulp.task("html",["styles","clean-html"],function(){var e=cssDir+"/spinners/",t=Q.defer();return fs.mkdirSync(htmlDir),fs.readdir(e,function(n,r){var i=r.map(function(t){if(t.indexOf(".css")===-1)return;var n=Q.defer(),r=t.replace(".css","").replace(/-/g," "),i=e+t,s=t.replace(".css",".html"),o=function(e,t){e&&(console.log(e),n.reject(e));var i=getHtmlUsageExample(t),o=_.template(htmlTmpl,{css:t,title:r,bodyContent:i});fs.writeFile(htmlDir+"/"+s,o,function(e,t){e&&(console.log(e),n.reject(e)),n.resolve()})};return fs.readFile(i,{encoding:"utf8"},o),n.promise});Q.all(i).then(t.resolve)}),t}),gulp.task("build",["html","styles"]),gulp.task("default",["build"]),gulp.task("watch",["build"],function(){gulp.watch(scssDir+"/**/*.scss",["build"])});