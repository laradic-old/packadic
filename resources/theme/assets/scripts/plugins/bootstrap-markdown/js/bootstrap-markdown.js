!function(e){var t=function(t,n){var r=["autofocus","savable","hideable","width","height","resize","iconlibrary","language","footer","fullscreen","hiddenButtons","disabledButtons"];e.each(r,function(r,i){typeof e(t).data(i)!="undefined"&&(n=typeof n=="object"?n:{},n[i]=e(t).data(i))}),this.$ns="bootstrap-markdown",this.$element=e(t),this.$editable={el:null,type:null,attrKeys:[],attrValues:[],content:null},this.$options=e.extend(!0,{},e.fn.markdown.defaults,n,this.$element.data("options")),this.$oldContent=null,this.$isPreview=!1,this.$isFullscreen=!1,this.$editor=null,this.$textarea=null,this.$handler=[],this.$callback=[],this.$nextTab=[],this.showEditor()};t.prototype={constructor:t,__alterButtons:function(t,n){var r=this.$handler,i=t=="all",s=this;e.each(r,function(e,r){var o=!0;i?o=!1:o=r.indexOf(t)<0,o===!1&&n(s.$editor.find('button[data-handler="'+r+'"]'))})},__buildButtons:function(t,n){var r,i=this.$ns,s=this.$handler,o=this.$callback;for(r=0;r<t.length;r++){var u,a=t[r];for(u=0;u<a.length;u++){var f,l=a[u].data,c=e("<div/>",{"class":"btn-group"});for(f=0;f<l.length;f++){var h=l[f],p,d,v=i+"-"+h.name,m=this.__getIcon(h.icon),g=h.btnText?h.btnText:"",y=h.btnClass?h.btnClass:"btn",b=h.tabIndex?h.tabIndex:"-1",w=typeof h.hotkey!="undefined"?h.hotkey:"",E=typeof jQuery.hotkeys!="undefined"&&w!==""?" ("+w+")":"";p=e("<button></button>"),p.text(" "+this.__localize(g)).addClass("btn-default btn-sm").addClass(y),y.match(/btn\-(primary|success|info|warning|danger|link)/)&&p.removeClass("btn-default"),p.attr({type:"button",title:this.__localize(h.title)+E,tabindex:b,"data-provider":i,"data-handler":v,"data-hotkey":w}),h.toggle===!0&&p.attr("data-toggle","button"),d=e("<span/>"),d.addClass(m),d.prependTo(p),c.append(p),s.push(v),o.push(h.callback)}n.append(c)}}return n},__setListener:function(){var t=typeof this.$textarea.attr("rows")!="undefined",n=this.$textarea.val().split("\n").length>5?this.$textarea.val().split("\n").length:"5",r=t?this.$textarea.attr("rows"):n;this.$textarea.attr("rows",r),this.$options.resize&&this.$textarea.css("resize",this.$options.resize),this.$textarea.on("focus",e.proxy(this.focus,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)).on("change",e.proxy(this.change,this)),this.eventSupported("keydown")&&this.$textarea.on("keydown",e.proxy(this.keydown,this)),this.$textarea.data("markdown",this)},__handle:function(t){var n=e(t.currentTarget),r=this.$handler,i=this.$callback,s=n.attr("data-handler"),o=r.indexOf(s),u=i[o];e(t.currentTarget).focus(),u(this),this.change(this),s.indexOf("cmdSave")<0&&this.$textarea.focus(),t.preventDefault()},__localize:function(t){var n=e.fn.markdown.messages,r=this.$options.language;return typeof n!="undefined"&&typeof n[r]!="undefined"&&typeof n[r][t]!="undefined"?n[r][t]:t},__getIcon:function(e){return typeof e=="object"?e[this.$options.iconlibrary]:e},setFullscreen:function(t){var n=this.$editor,r=this.$textarea;t===!0?(n.addClass("md-fullscreen-mode"),e("body").addClass("md-nooverflow"),this.$options.onFullscreen(this)):(n.removeClass("md-fullscreen-mode"),e("body").removeClass("md-nooverflow")),this.$isFullscreen=t,r.focus()},showEditor:function(){var t=this,n,r=this.$ns,i=this.$element,s=i.css("height"),o=i.css("width"),u=this.$editable,a=this.$handler,f=this.$callback,l=this.$options,c=e("<div/>",{"class":"md-editor",click:function(){t.focus()}});if(this.$editor===null){var h=e("<div/>",{"class":"md-header btn-toolbar"}),p=[];l.buttons.length>0&&(p=p.concat(l.buttons[0])),l.additionalButtons.length>0&&(p=p.concat(l.additionalButtons[0])),l.reorderButtonGroups.length>0&&(p=p.filter(function(e){return l.reorderButtonGroups.indexOf(e.name)>-1}).sort(function(e,t){return l.reorderButtonGroups.indexOf(e.name)<l.reorderButtonGroups.indexOf(t.name)?-1:l.reorderButtonGroups.indexOf(e.name)>l.reorderButtonGroups.indexOf(t.name)?1:0})),p.length>0&&(h=this.__buildButtons([p],h)),l.fullscreen.enable&&h.append('<div class="md-controls"><a class="md-control md-control-fullscreen" href="#"><span class="'+this.__getIcon(l.fullscreen.icons.fullscreenOn)+'"></span></a></div>').on("click",".md-control-fullscreen",function(e){e.preventDefault(),t.setFullscreen(!0)}),c.append(h);if(i.is("textarea"))i.before(c),n=i,n.addClass("md-input"),c.append(n);else{var d=typeof toMarkdown=="function"?toMarkdown(i.html()):i.html(),v=e.trim(d);n=e("<textarea/>",{"class":"md-input",val:v}),c.append(n),u.el=i,u.type=i.prop("tagName").toLowerCase(),u.content=i.html(),e(i[0].attributes).each(function(){u.attrKeys.push(this.nodeName),u.attrValues.push(this.nodeValue)}),i.replaceWith(c)}var m=e("<div/>",{"class":"md-footer"}),g=!1,y="";if(l.savable){g=!0;var b="cmdSave";a.push(b),f.push(l.onSave),m.append('<button class="btn btn-success" data-provider="'+r+'" data-handler="'+b+'"><i class="icon icon-white icon-ok"></i> '+this.__localize("Save")+"</button>")}y=typeof l.footer=="function"?l.footer(this):l.footer,e.trim(y)!==""&&(g=!0,m.append(y)),g&&c.append(m),l.width&&l.width!=="inherit"&&(jQuery.isNumeric(l.width)?(c.css("display","table"),n.css("width",l.width+"px")):c.addClass(l.width));if(l.height&&l.height!=="inherit")if(jQuery.isNumeric(l.height)){var w=l.height;h&&(w=Math.max(0,w-h.outerHeight())),m&&(w=Math.max(0,w-m.outerHeight())),n.css("height",w+"px")}else c.addClass(l.height);this.$editor=c,this.$textarea=n,this.$editable=u,this.$oldContent=this.getContent(),this.__setListener(),this.$editor.attr("id",(new Date).getTime()),this.$editor.on("click",'[data-provider="bootstrap-markdown"]',e.proxy(this.__handle,this));if(this.$element.is(":disabled")||this.$element.is("[readonly]"))this.$editor.addClass("md-editor-disabled"),this.disableButtons("all");this.eventSupported("keydown")&&typeof jQuery.hotkeys=="object"&&h.find('[data-provider="bootstrap-markdown"]').each(function(){var t=e(this),r=t.attr("data-hotkey");r.toLowerCase()!==""&&n.bind("keydown",r,function(){return t.trigger("click"),!1})}),l.initialstate==="preview"?this.showPreview():l.initialstate==="fullscreen"&&l.fullscreen.enable&&this.setFullscreen(!0)}else this.$editor.show();return l.autofocus&&(this.$textarea.focus(),this.$editor.addClass("active")),l.fullscreen.enable&&l.fullscreen!==!1&&(this.$editor.append('          <div class="md-fullscreen-controls">            <a href="#" class="exit-fullscreen" title="Exit fullscreen"><span class="'+this.__getIcon(l.fullscreen.icons.fullscreenOff)+'"></span></a>          </div>'),this.$editor.on("click",".exit-fullscreen",function(e){e.preventDefault(),t.setFullscreen(!1)})),this.hideButtons(l.hiddenButtons),this.disableButtons(l.disabledButtons),l.onShow(this),this},parseContent:function(e){var t,e=e||this.$textarea.val();return typeof markdown=="object"?t=markdown.toHTML(e):typeof marked=="function"?t=marked(e):t=e,t},showPreview:function(){var t=this.$options,n=this.$textarea,r=n.next(),i=e("<div/>",{"class":"md-preview","data-provider":"markdown-preview"}),s,o;this.$isPreview=!0,this.disableButtons("all").enableButtons("cmdPreview"),o=t.onPreview(this),s=typeof o=="string"?o:this.parseContent(),i.html(s),r&&r.attr("class")=="md-footer"?i.insertBefore(r):n.parent().append(i),i.css({width:n.outerWidth()+"px",height:n.outerHeight()+"px"}),this.$options.resize&&i.css("resize",this.$options.resize),n.hide(),i.data("markdown",this);if(this.$element.is(":disabled")||this.$element.is("[readonly]"))this.$editor.addClass("md-editor-disabled"),this.disableButtons("all");return this},hidePreview:function(){this.$isPreview=!1;var e=this.$editor.find('div[data-provider="markdown-preview"]');return e.remove(),this.enableButtons("all"),this.disableButtons(this.$options.disabledButtons),this.$textarea.show(),this.__setListener(),this},isDirty:function(){return this.$oldContent!=this.getContent()},getContent:function(){return this.$textarea.val()},setContent:function(e){return this.$textarea.val(e),this},findSelection:function(e){var t=this.getContent(),n;if(n=t.indexOf(e),n>=0&&e.length>0){var r=this.getSelection(),i;return this.setSelection(n,n+e.length),i=this.getSelection(),this.setSelection(r.start,r.end),i}return null},getSelection:function(){var e=this.$textarea[0];return("selectionStart"in e&&function(){var t=e.selectionEnd-e.selectionStart;return{start:e.selectionStart,end:e.selectionEnd,length:t,text:e.value.substr(e.selectionStart,t)}}||function(){return null})()},setSelection:function(e,t){var n=this.$textarea[0];return("selectionStart"in n&&function(){n.selectionStart=e,n.selectionEnd=t;return}||function(){return null})()},replaceSelection:function(e){var t=this.$textarea[0];return("selectionStart"in t&&function(){return t.value=t.value.substr(0,t.selectionStart)+e+t.value.substr(t.selectionEnd,t.value.length),t.selectionStart=t.value.length,this}||function(){return t.value+=e,jQuery(t)})()},getNextTab:function(){if(this.$nextTab.length===0)return null;var e,t=this.$nextTab.shift();return typeof t=="function"?e=t():typeof t=="object"&&t.length>0&&(e=t),e},setNextTab:function(e,t){if(typeof e=="string"){var n=this;this.$nextTab.push(function(){return n.findSelection(e)})}else if(typeof e=="number"&&typeof t=="number"){var r=this.getSelection();this.setSelection(e,t),this.$nextTab.push(this.getSelection()),this.setSelection(r.start,r.end)}return},__parseButtonNameParam:function(e){var t=[];return typeof e=="string"?t=e.split(","):t=e,t},enableButtons:function(t){var n=this.__parseButtonNameParam(t),r=this;return e.each(n,function(e,t){r.__alterButtons(n[e],function(e){e.removeAttr("disabled")})}),this},disableButtons:function(t){var n=this.__parseButtonNameParam(t),r=this;return e.each(n,function(e,t){r.__alterButtons(n[e],function(e){e.attr("disabled","disabled")})}),this},hideButtons:function(t){var n=this.__parseButtonNameParam(t),r=this;return e.each(n,function(e,t){r.__alterButtons(n[e],function(e){e.addClass("hidden")})}),this},showButtons:function(t){var n=this.__parseButtonNameParam(t),r=this;return e.each(n,function(e,t){r.__alterButtons(n[e],function(e){e.removeClass("hidden")})}),this},eventSupported:function(e){var t=e in this.$element;return t||(this.$element.setAttribute(e,"return;"),t=typeof this.$element[e]=="function"),t},keyup:function(e){var t=!1;switch(e.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:var n;if(n=this.getNextTab(),n!==null){var r=this;setTimeout(function(){r.setSelection(n.start,n.end)},500),t=!0}else{var i=this.getSelection();i.start==i.end&&i.end==this.getContent().length?t=!1:(this.setSelection(this.getContent().length,this.getContent().length),t=!0)}break;case 13:t=!1;break;case 27:this.$isFullscreen&&this.setFullscreen(!1),t=!1;break;default:t=!1}t&&(e.stopPropagation(),e.preventDefault()),this.$options.onChange(this)},change:function(e){return this.$options.onChange(this),this},focus:function(t){var n=this.$options,r=n.hideable,i=this.$editor;return i.addClass("active"),e(document).find(".md-editor").each(function(){if(e(this).attr("id")!==i.attr("id")){var t;if(t=e(this).find("textarea").data("markdown"),t===null)t=e(this).find('div[data-provider="markdown-preview"]').data("markdown");t&&t.blur()}}),n.onFocus(this),this},blur:function(t){var n=this.$options,r=n.hideable,i=this.$editor,s=this.$editable;if(i.hasClass("active")||this.$element.parent().length===0){i.removeClass("active");if(r)if(s.el!==null){var o=e("<"+s.type+"/>"),u=this.getContent(),a=typeof markdown=="object"?markdown.toHTML(u):u;e(s.attrKeys).each(function(e,t){o.attr(s.attrKeys[e],s.attrValues[e])}),o.html(a),i.replaceWith(o)}else i.hide();n.onBlur(this)}return this}};var n=e.fn.markdown;e.fn.markdown=function(n){return this.each(function(){var r=e(this),i=r.data("markdown"),s=typeof n=="object"&&n;i||r.data("markdown",i=new t(this,s))})},e.fn.markdown.messages={},e.fn.markdown.defaults={autofocus:!1,hideable:!1,savable:!1,width:"inherit",height:"inherit",resize:"none",iconlibrary:"glyph",language:"en",initialstate:"editor",buttons:[[{name:"groupFont",data:[{name:"cmdBold",hotkey:"Ctrl+B",title:"Bold",icon:{glyph:"glyphicon glyphicon-bold",fa:"fa fa-bold","fa-3":"icon-bold"},callback:function(e){var t,n,r=e.getSelection(),i=e.getContent();r.length===0?t=e.__localize("strong text"):t=r.text,i.substr(r.start-2,2)==="**"&&i.substr(r.end,2)==="**"?(e.setSelection(r.start-2,r.end+2),e.replaceSelection(t),n=r.start-2):(e.replaceSelection("**"+t+"**"),n=r.start+2),e.setSelection(n,n+t.length)}},{name:"cmdItalic",title:"Italic",hotkey:"Ctrl+I",icon:{glyph:"glyphicon glyphicon-italic",fa:"fa fa-italic","fa-3":"icon-italic"},callback:function(e){var t,n,r=e.getSelection(),i=e.getContent();r.length===0?t=e.__localize("emphasized text"):t=r.text,i.substr(r.start-1,1)==="_"&&i.substr(r.end,1)==="_"?(e.setSelection(r.start-1,r.end+1),e.replaceSelection(t),n=r.start-1):(e.replaceSelection("_"+t+"_"),n=r.start+1),e.setSelection(n,n+t.length)}},{name:"cmdHeading",title:"Heading",hotkey:"Ctrl+H",icon:{glyph:"glyphicon glyphicon-header",fa:"fa fa-header","fa-3":"icon-font"},callback:function(e){var t,n,r=e.getSelection(),i=e.getContent(),s,o;r.length===0?t=e.__localize("heading text"):t=r.text+"\n",(s=4,i.substr(r.start-s,s)==="### ")||(s=3,i.substr(r.start-s,s)==="###")?(e.setSelection(r.start-s,r.end),e.replaceSelection(t),n=r.start-s):r.start>0&&(o=i.substr(r.start-1,1),!!o&&o!="\n")?(e.replaceSelection("\n\n### "+t),n=r.start+6):(e.replaceSelection("### "+t),n=r.start+4),e.setSelection(n,n+t.length)}}]},{name:"groupLink",data:[{name:"cmdUrl",title:"URL/Link",hotkey:"Ctrl+L",icon:{glyph:"glyphicon glyphicon-link",fa:"fa fa-link","fa-3":"icon-link"},callback:function(t){var n,r,i=t.getSelection(),s=t.getContent(),o;i.length===0?n=t.__localize("enter link description here"):n=i.text,o=prompt(t.__localize("Insert Hyperlink"),"http://");if(o!==null&&o!==""&&o!=="http://"&&o.substr(0,4)==="http"){var u=e("<div>"+o+"</div>").text();t.replaceSelection("["+n+"]("+u+")"),r=i.start+1,t.setSelection(r,r+n.length)}}},{name:"cmdImage",title:"Image",hotkey:"Ctrl+G",icon:{glyph:"glyphicon glyphicon-picture",fa:"fa fa-picture-o","fa-3":"icon-picture"},callback:function(t){var n,r,i=t.getSelection(),s=t.getContent(),o;i.length===0?n=t.__localize("enter image description here"):n=i.text,o=prompt(t.__localize("Insert Image Hyperlink"),"http://");if(o!==null&&o!==""&&o!=="http://"&&o.substr(0,4)==="http"){var u=e("<div>"+o+"</div>").text();t.replaceSelection("!["+n+"]("+u+' "'+t.__localize("enter image title here")+'")'),r=i.start+2,t.setNextTab(t.__localize("enter image title here")),t.setSelection(r,r+n.length)}}}]},{name:"groupMisc",data:[{name:"cmdList",hotkey:"Ctrl+U",title:"Unordered List",icon:{glyph:"glyphicon glyphicon-list",fa:"fa fa-list","fa-3":"icon-list-ul"},callback:function(t){var n,r,i=t.getSelection(),s=t.getContent();if(i.length===0)n=t.__localize("list text here"),t.replaceSelection("- "+n),r=i.start+2;else if(i.text.indexOf("\n")<0)n=i.text,t.replaceSelection("- "+n),r=i.start+2;else{var o=[];o=i.text.split("\n"),n=o[0],e.each(o,function(e,t){o[e]="- "+t}),t.replaceSelection("\n\n"+o.join("\n")),r=i.start+4}t.setSelection(r,r+n.length)}},{name:"cmdListO",hotkey:"Ctrl+O",title:"Ordered List",icon:{glyph:"glyphicon glyphicon-th-list",fa:"fa fa-list-ol","fa-3":"icon-list-ol"},callback:function(t){var n,r,i=t.getSelection(),s=t.getContent();if(i.length===0)n=t.__localize("list text here"),t.replaceSelection("1. "+n),r=i.start+3;else if(i.text.indexOf("\n")<0)n=i.text,t.replaceSelection("1. "+n),r=i.start+3;else{var o=[];o=i.text.split("\n"),n=o[0],e.each(o,function(e,t){o[e]="1. "+t}),t.replaceSelection("\n\n"+o.join("\n")),r=i.start+5}t.setSelection(r,r+n.length)}},{name:"cmdCode",hotkey:"Ctrl+K",title:"Code",icon:{glyph:"glyphicon glyphicon-asterisk",fa:"fa fa-code","fa-3":"icon-code"},callback:function(e){var t,n,r=e.getSelection(),i=e.getContent();r.length===0?t=e.__localize("code text here"):t=r.text,i.substr(r.start-4,4)==="```\n"&&i.substr(r.end,4)==="\n```"?(e.setSelection(r.start-4,r.end+4),e.replaceSelection(t),n=r.start-4):i.substr(r.start-1,1)==="`"&&i.substr(r.end,1)==="`"?(e.setSelection(r.start-1,r.end+1),e.replaceSelection(t),n=r.start-1):i.indexOf("\n")>-1?(e.replaceSelection("```\n"+t+"\n```"),n=r.start+4):(e.replaceSelection("`"+t+"`"),n=r.start+1),e.setSelection(n,n+t.length)}},{name:"cmdQuote",hotkey:"Ctrl+Q",title:"Quote",icon:{glyph:"glyphicon glyphicon-comment",fa:"fa fa-quote-left","fa-3":"icon-quote-left"},callback:function(t){var n,r,i=t.getSelection(),s=t.getContent();if(i.length===0)n=t.__localize("quote here"),t.replaceSelection("> "+n),r=i.start+2;else if(i.text.indexOf("\n")<0)n=i.text,t.replaceSelection("> "+n),r=i.start+2;else{var o=[];o=i.text.split("\n"),n=o[0],e.each(o,function(e,t){o[e]="> "+t}),t.replaceSelection("\n\n"+o.join("\n")),r=i.start+4}t.setSelection(r,r+n.length)}}]},{name:"groupUtil",data:[{name:"cmdPreview",toggle:!0,hotkey:"Ctrl+P",title:"Preview",btnText:"Preview",btnClass:"btn btn-primary btn-sm",icon:{glyph:"glyphicon glyphicon-search",fa:"fa fa-search","fa-3":"icon-search"},callback:function(e){var t=e.$isPreview,n;t===!1?e.showPreview():e.hidePreview()}}]}]],additionalButtons:[],reorderButtonGroups:[],hiddenButtons:[],disabledButtons:[],footer:"",fullscreen:{enable:!0,icons:{fullscreenOn:{fa:"fa fa-expand",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-full"},fullscreenOff:{fa:"fa fa-compress",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-small"}}},onShow:function(e){},onPreview:function(e){},onSave:function(e){},onBlur:function(e){},onFocus:function(e){},onChange:function(e){},onFullscreen:function(e){}},e.fn.markdown.Constructor=t,e.fn.markdown.noConflict=function(){return e.fn.markdown=n,this};var r=function(e){var t=e;if(t.data("markdown")){t.data("markdown").showEditor();return}t.markdown()},i=function(t){var n=e(document.activeElement);e(document).find(".md-editor").each(function(){var t=e(this),r=n.closest(".md-editor")[0]===this,i=t.find("textarea").data("markdown")||t.find('div[data-provider="markdown-preview"]').data("markdown");i&&!r&&i.blur()})};e(document).on("click.markdown.data-api",'[data-provide="markdown-editable"]',function(t){r(e(this)),t.preventDefault()}).on("click focusin",function(e){i(e)}).ready(function(){e('textarea[data-provide="markdown"]').each(function(){r(e(this))})})}(window.jQuery);