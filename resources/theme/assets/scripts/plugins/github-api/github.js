(function(){var e,t;typeof exports!="undefined"?(e=require("xmlhttprequest").XMLHttpRequest,t=require("underscore"),btoa=require("btoa")):t=window._,typeof window!="undefined"&&typeof window.XMLHttpRequest!="undefined"&&(e=window.XMLHttpRequest);var n="https://api.github.com",r=function(i){function s(t,r,s,o,u,a){function f(){var e=r.indexOf("//")>=0?r:n+r;return e+(/\?/.test(e)?"&":"?")+(new Date).getTime()}var l=new e;l.open(t,f(),!a),a||(l.onreadystatechange=function(){this.readyState==4&&(this.status>=200&&this.status<300||this.status===304?o(null,u?this.responseText:this.responseText?JSON.parse(this.responseText):!0,this):o({path:r,request:this,error:this.status}))}),u?l.setRequestHeader("Accept","application/vnd.github.v3.raw+json"):(l.dataType="json",l.setRequestHeader("Accept","application/vnd.github.v3+json")),l.setRequestHeader("Content-Type","application/json;charset=UTF-8");if(i.token||i.username&&i.password){var c=i.token?"token "+i.token:"Basic "+btoa(i.username+":"+i.password);l.setRequestHeader("Authorization",c)}s?l.send(JSON.stringify(s)):l.send();if(a)return l.response}function o(e,n){var r=[];(function i(){s("GET",e,null,function(s,o,u){if(s)return n(s);r.push.apply(r,o);var a=(u.getResponseHeader("link")||"").split(/\s*,\s*/g),f=t.find(a,function(e){return/rel="next"/.test(e)});f&&(f=(/<(.*)>/.exec(f)||[])[1]),f?(e=f,i()):n(s,r)})})()}r.User=function(){this.repos=function(e){o("/user/repos?type=all&per_page=1000&sort=updated",function(t,n){e(t,n)})},this.orgs=function(e){s("GET","/user/orgs",null,function(t,n){e(t,n)})},this.gists=function(e){s("GET","/gists",null,function(t,n){e(t,n)})},this.notifications=function(e){s("GET","/notifications",null,function(t,n){e(t,n)})},this.show=function(e,t){var n=e?"/users/"+e:"/user";s("GET",n,null,function(e,n){t(e,n)})},this.userRepos=function(e,t){o("/users/"+e+"/repos?type=all&per_page=1000&sort=updated",function(e,n){t(e,n)})},this.userGists=function(e,t){s("GET","/users/"+e+"/gists",null,function(e,n){t(e,n)})},this.orgRepos=function(e,t){o("/orgs/"+e+"/repos?type=all&&page_num=1000&sort=updated&direction=desc",function(e,n){t(e,n)})},this.follow=function(e,t){s("PUT","/user/following/"+e,null,function(e,n){t(e,n)})},this.unfollow=function(e,t){s("DELETE","/user/following/"+e,null,function(e,n){t(e,n)})},this.createRepo=function(e,t){s("POST","/user/repos",e,t)}},r.Repository=function(e){function f(e,t){if(e===a.branch&&a.sha)return t(null,a.sha);o.getRef("heads/"+e,function(n,r){a.branch=e,a.sha=r,t(n,r)})}var n=e.name,i=e.user,o=this,u="/repos/"+i+"/"+n,a={branch:null,sha:null};this.deleteRepo=function(t){s("DELETE",u,e,t)},this.getRef=function(e,t){s("GET",u+"/git/refs/"+e,null,function(e,n){if(e)return t(e);t(null,n.object.sha)})},this.createRef=function(e,t){s("POST",u+"/git/refs",e,t)},this.deleteRef=function(t,n){s("DELETE",u+"/git/refs/"+t,e,n)},this.createRepo=function(e,t){s("POST","/user/repos",e,t)},this.deleteRepo=function(t){s("DELETE",u,e,t)},this.listTags=function(e){s("GET",u+"/tags",null,function(t,n){if(t)return e(t);e(null,n)})},this.listPulls=function(e,t){s("GET",u+"/pulls"+(e?"?state="+e:""),null,function(e,n){if(e)return t(e);t(null,n)})},this.getPull=function(e,t){s("GET",u+"/pulls/"+e,null,function(e,n){if(e)return t(e);t(null,n)})},this.compare=function(e,t,n){s("GET",u+"/compare/"+e+"..."+t,null,function(e,t){if(e)return n(e);n(null,t)})},this.listBranches=function(e){s("GET",u+"/git/refs/heads",null,function(n,r){if(n)return e(n);e(null,t.map(r,function(e){return t.last(e.ref.split("/"))}))})},this.getBlob=function(e,t){s("GET",u+"/git/blobs/"+e,null,t,"raw")},this.getCommit=function(e,t,n){s("GET",u+"/git/commits/"+t,null,function(e,t){if(e)return n(e);n(null,t)})},this.getSha=function(e,t,n){if(!t||t==="")return o.getRef("heads/"+e,n);s("GET",u+"/contents/"+t,{ref:e},function(e,t){if(e)return n(e);n(null,t.sha)})},this.getTree=function(e,t){s("GET",u+"/git/trees/"+e,null,function(e,n){if(e)return t(e);t(null,n.tree)})},this.postBlob=function(e,t){typeof e=="string"?e={content:e,encoding:"utf-8"}:e={content:btoa(String.fromCharCode.apply(null,new Uint8Array(e))),encoding:"base64"},s("POST",u+"/git/blobs",e,function(e,n){if(e)return t(e);t(null,n.sha)})},this.updateTree=function(e,t,n,r){var i={base_tree:e,tree:[{path:t,mode:"100644",type:"blob",sha:n}]};s("POST",u+"/git/trees",i,function(e,t){if(e)return r(e);r(null,t.sha)})},this.postTree=function(e,t){s("POST",u+"/git/trees",{tree:e},function(e,n){if(e)return t(e);t(null,n.sha)})},this.commit=function(t,n,i,o){var f=new r.User;f.show(null,function(r,f){if(r)return o(r);var l={message:i,author:{name:e.user,email:f.email},parents:[t],tree:n};s("POST",u+"/git/commits",l,function(e,t){if(e)return o(e);a.sha=t.sha,o(null,t.sha)})})},this.updateHead=function(e,t,n){s("PATCH",u+"/git/refs/heads/"+e,{sha:t},function(e,t){n(e)})},this.show=function(e){s("GET",u,null,e)},this.contents=function(e,t,n){s("GET",u+"/contents/"+t,{ref:e},n)},this.fork=function(e){s("POST",u+"/forks",null,e)},this.branch=function(e,t,n){arguments.length===2&&typeof arguments[1]=="function"&&(n=t,t=e,e="master"),this.getRef("heads/"+e,function(e,r){if(e&&n)return n(e);o.createRef({ref:"refs/heads/"+t,sha:r},n)})},this.createPullRequest=function(e,t){s("POST",u+"/pulls",e,t)},this.listHooks=function(e){s("GET",u+"/hooks",null,e)},this.getHook=function(e,t){s("GET",u+"/hooks/"+e,null,t)},this.createHook=function(e,t){s("POST",u+"/hooks",e,t)},this.editHook=function(e,t,n){s("PATCH",u+"/hooks/"+e,t,n)},this.deleteHook=function(e,t){s("DELETE",u+"/hooks/"+e,null,t)},this.read=function(e,t,n){s("GET",u+"/contents/"+t,{ref:e},function(e,t){if(e&&e.error===404)return n("not found",null,null);if(e)return n(e);n(null,t)},!0)},this.remove=function(e,t,n){o.getSha(e,t,function(r,i){if(r)return n(r);s("DELETE",u+"/contents/"+t,{message:t+" is removed",sha:i,branch:e},n)})},this.delete=function(e,t,n){o.getSha(e,t,function(r,i){if(!i)return n("not found",null);var o=u+"/contents/"+t,a={message:"Deleted "+t,sha:i};o+="?message="+encodeURIComponent(a.message),o+="&sha="+encodeURIComponent(a.sha),o+="&branch="+encodeURIComponent(e),s("DELETE",o,null,n)})},this.move=function(e,n,r,i){f(e,function(s,u){o.getTree(u+"?recursive=true",function(s,a){t.each(a,function(e){e.path===n&&(e.path=r),e.type==="tree"&&delete e.sha}),o.postTree(a,function(t,r){o.commit(u,r,"Deleted "+n,function(t,n){o.updateHead(e,n,function(e){i(e)})})})})})},this.write=function(e,t,n,r,i){o.getSha(e,t,function(o,a){if(o&&o.error!=404)return i(o);s("PUT",u+"/contents/"+t,{message:r,content:btoa(n),branch:e,sha:a},i)})},this.getCommits=function(e,t){e=e||{};var n=u+"/commits",r=[];e.sha&&r.push("sha="+encodeURIComponent(e.sha)),e.path&&r.push("path="+encodeURIComponent(e.path));if(e.since){var i=e.since;i.constructor===Date&&(i=i.toISOString()),r.push("since="+encodeURIComponent(i))}if(e.until){var o=e.until;o.constructor===Date&&(o=o.toISOString()),r.push("until="+encodeURIComponent(o))}e.page&&r.push("page="+e.page),e.perpage&&r.push("per_page="+e.perpage),r.length>0&&(n+="?"+r.join("&")),s("GET",n,null,t)}},r.Gist=function(e){var t=e.id,n="/gists/"+t;this.read=function(e){s("GET",n,null,function(t,n){e(t,n)})},this.create=function(e,t){s("POST","/gists",e,t)},this.delete=function(e){s("DELETE",n,null,function(t,n){e(t,n)})},this.fork=function(e){s("POST",n+"/fork",null,function(t,n){e(t,n)})},this.update=function(e,t){s("PATCH",n,e,function(e,n){t(e,n)})},this.star=function(e){s("PUT",n+"/star",null,function(t,n){e(t,n)})},this.unstar=function(e){s("DELETE",n+"/star",null,function(t,n){e(t,n)})},this.isStarred=function(e){s("GET",n+"/star",null,function(t,n){e(t,n)})}},r.Issue=function(e){var t="/repos/"+e.user+"/"+e.repo+"/issues";this.list=function(e,n){s("GET",t,e,n)}},this.getIssues=function(e,t){return new r.Issue({user:e,repo:t})},this.getRepo=function(e,t){return new r.Repository({user:e,name:t})},this.getUser=function(){return new r.User},this.getGist=function(e){return new r.Gist({id:e})}};typeof exports!="undefined"?module.exports=r:window.Github=r}).call(this);