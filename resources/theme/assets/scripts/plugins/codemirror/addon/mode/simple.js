(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){function t(e,t){if(!e.hasOwnProperty(t))throw new Error("Undefined state "+t+"in simple mode")}function n(e,t){if(!e)return/(?:)/;var n="";return e instanceof RegExp?(e.ignoreCase&&(n="i"),e=e.source):e=String(e),new RegExp((t===!1?"":"^")+"(?:"+e+")",n)}function r(e){if(!e)return null;if(typeof e=="string")return e.replace(/\./g," ");var t=[];for(var n=0;n<e.length;n++)t.push(e[n]&&e[n].replace(/\./g," "));return t}function i(e,i){(e.next||e.push)&&t(i,e.next||e.push),this.regex=n(e.regex),this.token=r(e.token),this.data=e}function s(e,t){return function(n,r){if(r.pending){var i=r.pending.shift();return r.pending.length==0&&(r.pending=null),n.pos+=i.text.length,i.token}if(r.local){if(r.local.end&&n.match(r.local.end)){var s=r.local.endToken||null;return r.local=r.localState=null,s}var s=r.local.mode.token(n,r.localState),o;return r.local.endScan&&(o=r.local.endScan.exec(n.current()))&&(n.pos=n.start+o.index),s}var a=e[r.state];for(var f=0;f<a.length;f++){var l=a[f],c=(!l.data.sol||n.sol())&&n.match(l.regex);if(c){l.data.next?r.state=l.data.next:l.data.push?((r.stack||(r.stack=[])).push(r.state),r.state=l.data.push):l.data.pop&&r.stack&&r.stack.length&&(r.state=r.stack.pop()),l.data.mode&&u(t,r,l.data.mode,l.token),l.data.indent&&r.indent.push(n.indentation()+t.indentUnit),l.data.dedent&&r.indent.pop();if(c.length>2){r.pending=[];for(var h=2;h<c.length;h++)c[h]&&r.pending.push({text:c[h],token:l.token[h-1]});return n.backUp(c[0].length-(c[1]?c[1].length:0)),l.token[0]}return l.token&&l.token.join?l.token[0]:l.token}}return n.next(),null}}function o(e,t){if(e===t)return!0;if(!e||typeof e!="object"||!t||typeof t!="object")return!1;var n=0;for(var r in e)if(e.hasOwnProperty(r)){if(!t.hasOwnProperty(r)||!o(e[r],t[r]))return!1;n++}for(var r in t)t.hasOwnProperty(r)&&n--;return n==0}function u(t,r,i,s){var u;if(i.persistent)for(var a=r.persistentStates;a&&!u;a=a.next)if(i.spec?o(i.spec,a.spec):i.mode==a.mode)u=a;var f=u?u.mode:i.mode||e.getMode(t,i.spec),l=u?u.state:e.startState(f);i.persistent&&!u&&(r.persistentStates={mode:f,spec:i.spec,state:l,next:r.persistentStates}),r.localState=l,r.local={mode:f,end:i.end&&n(i.end),endScan:i.end&&i.forceEnd!==!1&&n(i.end,!1),endToken:s&&s.join?s[s.length-1]:s}}function a(e,t){for(var n=0;n<t.length;n++)if(t[n]===e)return!0}function f(t,n){return function(r,i,s){if(r.local&&r.local.mode.indent)return r.local.mode.indent(r.localState,i,s);if(r.indent==null||r.local||n.dontIndentStates&&a(r.state,n.dontIndentStates)>-1)return e.Pass;var o=r.indent.length-1,u=t[r.state];e:for(;;){for(var f=0;f<u.length;f++){var l=u[f];if(l.data.dedent&&l.data.dedentIfLineStart!==!1){var c=l.regex.exec(i);if(c&&c[0]){o--;if(l.next||l.push)u=t[l.next||l.push];i=i.slice(c[0].length);continue e}}}break}return o<0?0:r.indent[o]}}e.defineSimpleMode=function(t,n){e.defineMode(t,function(t){return e.simpleMode(t,n)})},e.simpleMode=function(n,r){t(r,"start");var o={},u=r.meta||{},a=!1;for(var l in r)if(l!=u&&r.hasOwnProperty(l)){var c=o[l]=[],h=r[l];for(var p=0;p<h.length;p++){var d=h[p];c.push(new i(d,r));if(d.indent||d.dedent)a=!0}}var v={startState:function(){return{state:"start",pending:null,local:null,localState:null,indent:a?[]:null}},copyState:function(t){var n={state:t.state,pending:t.pending,local:t.local,localState:null,indent:t.indent&&t.indent.slice(0)};t.localState&&(n.localState=e.copyState(t.local.mode,t.localState)),t.stack&&(n.stack=t.stack.slice(0));for(var r=t.persistentStates;r;r=r.next)n.persistentStates={mode:r.mode,spec:r.spec,state:r.state==t.localState?n.localState:e.copyState(r.mode,r.state),next:n.persistentStates};return n},token:s(o,n),innerMode:function(e){return e.local&&{mode:e.local.mode,state:e.localState}},indent:f(o,u)};if(u)for(var m in u)u.hasOwnProperty(m)&&(v[m]=u[m]);return v}});