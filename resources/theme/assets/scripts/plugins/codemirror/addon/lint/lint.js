(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){function n(t,n){function i(t){if(!r.parentNode)return e.off(document,"mousemove",i);r.style.top=Math.max(0,t.clientY-r.offsetHeight-5)+"px",r.style.left=t.clientX+5+"px"}var r=document.createElement("div");return r.className="CodeMirror-lint-tooltip",r.appendChild(n.cloneNode(!0)),document.body.appendChild(r),e.on(document,"mousemove",i),i(t),r.style.opacity!=null&&(r.style.opacity=1),r}function r(e){e.parentNode&&e.parentNode.removeChild(e)}function i(e){if(!e.parentNode)return;e.style.opacity==null&&r(e),e.style.opacity=0,setTimeout(function(){r(e)},600)}function s(t,r,s){function u(){e.off(s,"mouseout",u),o&&(i(o),o=null)}var o=n(t,r),a=setInterval(function(){if(o)for(var e=s;;e=e.parentNode){if(e==document.body)return;if(!e){u();break}}if(!o)return clearInterval(a)},400);e.on(s,"mouseout",u)}function o(e,t,n){this.marked=[],this.options=t,this.timeout=null,this.hasGutter=n,this.onMouseOver=function(t){g(e,t)}}function u(t,n){if(n instanceof Function)return{getAnnotations:n};if(!n||n===!0)n={};n.getAnnotations||(n.getAnnotations=t.getHelper(e.Pos(0,0),"lint"));if(!n.getAnnotations)throw new Error("Required option 'getAnnotations' missing (lint addon)");return n}function a(e){var n=e.state.lint;n.hasGutter&&e.clearGutter(t);for(var r=0;r<n.marked.length;++r)n.marked[r].clear();n.marked.length=0}function f(t,n,r,i){var o=document.createElement("div"),u=o;return o.className="CodeMirror-lint-marker-"+n,r&&(u=o.appendChild(document.createElement("div")),u.className="CodeMirror-lint-marker-multiple"),i!=0&&e.on(u,"mouseover",function(e){s(e,t,u)}),o}function l(e,t){return e=="error"?e:t}function c(e){var t=[];for(var n=0;n<e.length;++n){var r=e[n],i=r.from.line;(t[i]||(t[i]=[])).push(r)}return t}function h(e){var t=e.severity;t||(t="error");var n=document.createElement("div");return n.className="CodeMirror-lint-message-"+t,n.appendChild(document.createTextNode(e.message)),n}function p(e){var t=e.state.lint,n=t.options,r=n.options||n;n.async?n.getAnnotations(e.getValue(),d,r,e):d(e,n.getAnnotations(e.getValue(),r,e))}function d(e,n){a(e);var r=e.state.lint,i=r.options,s=c(n);for(var o=0;o<s.length;++o){var u=s[o];if(!u)continue;var p=null,d=r.hasGutter&&document.createDocumentFragment();for(var v=0;v<u.length;++v){var m=u[v],g=m.severity;g||(g="error"),p=l(p,g),i.formatAnnotation&&(m=i.formatAnnotation(m)),r.hasGutter&&d.appendChild(h(m)),m.to&&r.marked.push(e.markText(m.from,m.to,{className:"CodeMirror-lint-mark-"+g,__annotation:m}))}r.hasGutter&&e.setGutterMarker(o,t,f(d,p,u.length>1,r.options.tooltips))}i.onUpdateLinting&&i.onUpdateLinting(n,s,e)}function v(e){var t=e.state.lint;clearTimeout(t.timeout),t.timeout=setTimeout(function(){p(e)},t.options.delay||500)}function m(e,t){var n=t.target||t.srcElement;s(t,h(e),n)}function g(e,t){var n=t.target||t.srcElement;if(!/\bCodeMirror-lint-mark-/.test(n.className))return;var r=n.getBoundingClientRect(),i=(r.left+r.right)/2,s=(r.top+r.bottom)/2,o=e.findMarksAt(e.coordsChar({left:i,top:s},"client"));for(var u=0;u<o.length;++u){var a=o[u].__annotation;if(a)return m(a,t)}}var t="CodeMirror-lint-markers";e.defineOption("lint",!1,function(n,r,i){i&&i!=e.Init&&(a(n),n.off("change",v),e.off(n.getWrapperElement(),"mouseover",n.state.lint.onMouseOver),delete n.state.lint);if(r){var s=n.getOption("gutters"),f=!1;for(var l=0;l<s.length;++l)s[l]==t&&(f=!0);var c=n.state.lint=new o(n,u(n,r),f);n.on("change",v),c.options.tooltips!=0&&e.on(n.getWrapperElement(),"mouseover",c.onMouseOver),p(n)}})});