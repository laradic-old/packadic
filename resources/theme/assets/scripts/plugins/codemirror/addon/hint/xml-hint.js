(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){function n(n,r){var i=r&&r.schemaInfo,s=r&&r.quoteChar||'"';if(!i)return;var o=n.getCursor(),u=n.getTokenAt(o);u.end>o.ch&&(u.end=o.ch,u.string=u.string.slice(0,o.ch-u.start));var a=e.innerMode(n.getMode(),u.state);if(a.mode.name!="xml")return;var f=[],l=!1,c,h=/\btag\b/.test(u.type)&&!/>$/.test(u.string),p=h&&/^\w/.test(u.string),d;if(p){var v=n.getLine(o.line).slice(Math.max(0,u.start-2),u.start),m=/<\/$/.test(v)?"close":/<$/.test(v)?"open":null;m&&(d=u.start-(m=="close"?2:1))}else h&&u.string=="<"?m="open":h&&u.string=="</"&&(m="close");if(!h&&!a.state.tagName||m){p&&(c=u.string),l=m;var g=a.state.context,y=g&&i[g.tagName],b=g?y&&y.children:i["!top"];if(b&&m!="close")for(var w=0;w<b.length;++w)(!c||b[w].lastIndexOf(c,0)==0)&&f.push("<"+b[w]);else if(m!="close")for(var E in i)i.hasOwnProperty(E)&&E!="!top"&&E!="!attrs"&&(!c||E.lastIndexOf(c,0)==0)&&f.push("<"+E);g&&(!c||m=="close"&&g.tagName.lastIndexOf(c,0)==0)&&f.push("</"+g.tagName+">")}else{var y=i[a.state.tagName],S=y&&y.attrs,x=i["!attrs"];if(!S&&!x)return;if(!S)S=x;else if(x){var T={};for(var N in x)x.hasOwnProperty(N)&&(T[N]=x[N]);for(var N in S)S.hasOwnProperty(N)&&(T[N]=S[N]);S=T}if(u.type=="string"||u.string=="="){var v=n.getRange(t(o.line,Math.max(0,o.ch-60)),t(o.line,u.type=="string"?u.start:u.end)),C=v.match(/([^\s\u00a0=<>\"\']+)=$/),k;if(!C||!S.hasOwnProperty(C[1])||!(k=S[C[1]]))return;typeof k=="function"&&(k=k.call(this,n));if(u.type=="string"){c=u.string;var L=0;/['"]/.test(u.string.charAt(0))&&(s=u.string.charAt(0),c=u.string.slice(1),L++);var A=u.string.length;/['"]/.test(u.string.charAt(A-1))&&(s=u.string.charAt(A-1),c=u.string.substr(L,A-2)),l=!0}for(var w=0;w<k.length;++w)(!c||k[w].lastIndexOf(c,0)==0)&&f.push(s+k[w]+s)}else{u.type=="attribute"&&(c=u.string,l=!0);for(var O in S)S.hasOwnProperty(O)&&(!c||O.lastIndexOf(c,0)==0)&&f.push(O)}}return{list:f,from:l?t(o.line,d==null?u.start:d):o,to:l?t(o.line,u.end):o}}var t=e.Pos;e.registerHelper("hint","xml",n)});