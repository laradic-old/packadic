(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){function t(e,t){this.cm=e,this.className=t,this.annotations=[],this.div=e.getWrapperElement().appendChild(document.createElement("div")),this.div.style.cssText="position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none",this.computeScale();var n=this;e.on("refresh",this.resizeHandler=function(){n.computeScale()&&n.redraw()})}e.defineExtension("annotateScrollbar",function(e){return new t(this,e)}),t.prototype.computeScale=function(){var e=this.cm,t=(e.getWrapperElement().clientHeight-e.display.barHeight)/e.heightAtLine(e.lastLine()+1,"local");if(t!=this.hScale)return this.hScale=t,!0},t.prototype.update=function(e){this.annotations=e,this.redraw()},t.prototype.redraw=function(){var e=this.cm,t=this.hScale;if(!e.display.barWidth)return;var n=document.createDocumentFragment(),r=this.annotations;for(var i=0,s;i<r.length;i++){var o=r[i],u=s||e.charCoords(o.from,"local").top*t,a=e.charCoords(o.to,"local").bottom*t;while(i<r.length-1){s=e.charCoords(r[i+1].from,"local").top*t;if(s>a+.9)break;o=r[++i],a=e.charCoords(o.to,"local").bottom*t}var f=Math.max(a-u,3),l=n.appendChild(document.createElement("div"));l.style.cssText="position: absolute; right: 0px; width: "+Math.max(e.display.barWidth-1,2)+"px; top: "+u+"px; height: "+f+"px",l.className=this.className}this.div.textContent="",this.div.appendChild(n)},t.prototype.clear=function(){this.cm.off("refresh",this.resizeHandler),this.div.parentNode.removeChild(this.div)}});