(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){function s(e){typeof e=="object"&&(this.minChars=e.minChars,this.style=e.style,this.showToken=e.showToken,this.delay=e.delay,this.wordsOnly=e.wordsOnly),this.style==null&&(this.style=n),this.minChars==null&&(this.minChars=t),this.delay==null&&(this.delay=r),this.wordsOnly==null&&(this.wordsOnly=i),this.overlay=this.timeout=null}function o(e){var t=e.state.matchHighlighter;clearTimeout(t.timeout),t.timeout=setTimeout(function(){u(e)},t.delay)}function u(e){e.operation(function(){var t=e.state.matchHighlighter;t.overlay&&(e.removeOverlay(t.overlay),t.overlay=null);if(!e.somethingSelected()&&t.showToken){var n=t.showToken===!0?/[\w$]/:t.showToken,r=e.getCursor(),i=e.getLine(r.line),s=r.ch,o=s;while(s&&n.test(i.charAt(s-1)))--s;while(o<i.length&&n.test(i.charAt(o)))++o;s<o&&e.addOverlay(t.overlay=l(i.slice(s,o),n,t.style));return}var u=e.getCursor("from"),f=e.getCursor("to");if(u.line!=f.line)return;if(t.wordsOnly&&!a(e,u,f))return;var c=e.getRange(u,f).replace(/^\s+|\s+$/g,"");c.length>=t.minChars&&e.addOverlay(t.overlay=l(c,!1,t.style))})}function a(e,t,n){var r=e.getRange(t,n);if(r.match(/^\w+$/)!==null){if(t.ch>0){var i={line:t.line,ch:t.ch-1},s=e.getRange(i,t);if(s.match(/\W/)===null)return!1}if(n.ch<e.getLine(t.line).length){var i={line:n.line,ch:n.ch+1},s=e.getRange(n,i);if(s.match(/\W/)===null)return!1}return!0}return!1}function f(e,t){return(!e.start||!t.test(e.string.charAt(e.start-1)))&&(e.pos==e.string.length||!t.test(e.string.charAt(e.pos)))}function l(e,t,n){return{token:function(r){if(r.match(e)&&(!t||f(r,t)))return n;r.next(),r.skipTo(e.charAt(0))||r.skipToEnd()}}}var t=2,n="matchhighlight",r=100,i=!1;e.defineOption("highlightSelectionMatches",!1,function(t,n,r){if(r&&r!=e.Init){var i=t.state.matchHighlighter.overlay;i&&t.removeOverlay(i),clearTimeout(t.state.matchHighlighter.timeout),t.state.matchHighlighter=null,t.off("cursorActivity",o)}n&&(t.state.matchHighlighter=new s(n),u(t),t.on("cursorActivity",o))})});