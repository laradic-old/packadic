(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){function s(e,t){var n=e.getRange(i(t.line,t.ch-1),i(t.line,t.ch+1));return n.length==2?n:null}function o(t,n,r){var i=t.getLine(n.line),s=t.getTokenAt(n);if(/\bstring2?\b/.test(s.type))return!1;var o=new e.StringStream(i.slice(0,n.ch)+r+i.slice(n.ch),4);o.pos=o.start=s.start;for(;;){var u=t.getMode().token(o,s.state);if(o.pos>=n.ch+1)return/\bstring2?\b/.test(u);o.start=o.pos}}function u(t){var n={name:"autoCloseBrackets",Backspace:function(n){if(n.getOption("disableInput"))return e.Pass;var r=n.listSelections();for(var o=0;o<r.length;o++){if(!r[o].empty())return e.Pass;var u=s(n,r[o].head);if(!u||t.indexOf(u)%2!=0)return e.Pass}for(var o=r.length-1;o>=0;o--){var a=r[o].head;n.replaceRange("",i(a.line,a.ch-1),i(a.line,a.ch+1))}}},u="";for(var a=0;a<t.length;a+=2)(function(t,s){u+=s,n["'"+t+"'"]=function(n){if(n.getOption("disableInput"))return e.Pass;var a=n.listSelections(),f,l;for(var c=0;c<a.length;c++){var h=a[c],p=h.head,d,l=n.getRange(p,i(p.line,p.ch+1));if(!h.empty())d="surround";else if(t==s&&l==s)n.getRange(p,i(p.line,p.ch+3))==t+t+t?d="skipThree":d="skip";else if(t==s&&p.ch>1&&n.getRange(i(p.line,p.ch-2),p)==t+t&&(p.ch<=2||n.getRange(i(p.line,p.ch-3),i(p.line,p.ch-2))!=t))d="addFour";else if(t=='"'||t=="'"){if(!!e.isWordChar(l)||!o(n,p,t))return e.Pass;d="both"}else{if(!(n.getLine(p.line).length==p.ch||u.indexOf(l)>=0||r.test(l)))return e.Pass;d="both"}if(!f)f=d;else if(f!=d)return e.Pass}n.operation(function(){if(f=="skip")n.execCommand("goCharRight");else if(f=="skipThree")for(var e=0;e<3;e++)n.execCommand("goCharRight");else if(f=="surround"){var r=n.getSelections();for(var e=0;e<r.length;e++)r[e]=t+r[e]+s;n.replaceSelections(r,"around")}else f=="both"?(n.replaceSelection(t+s,null),n.execCommand("goCharLeft")):f=="addFour"&&(n.replaceSelection(t+t+t+t,"before"),n.execCommand("goCharRight"))})},t!=s&&(n["'"+s+"'"]=function(t){var n=t.listSelections();for(var r=0;r<n.length;r++){var o=n[r];if(!o.empty()||t.getRange(o.head,i(o.head.line,o.head.ch+1))!=s)return e.Pass}t.execCommand("goCharRight")})})(t.charAt(a),t.charAt(a+1));return n}function a(t){return function(n){if(n.getOption("disableInput"))return e.Pass;var r=n.listSelections();for(var i=0;i<r.length;i++){if(!r[i].empty())return e.Pass;var o=s(n,r[i].head);if(!o||t.indexOf(o)%2!=0)return e.Pass}n.operation(function(){n.replaceSelection("\n\n",null),n.execCommand("goCharLeft"),r=n.listSelections();for(var e=0;e<r.length;e++){var t=r[e].head.line;n.indentLine(t,null,!0),n.indentLine(t+1,null,!0)}})}}var t="()[]{}''\"\"",n="[]{}",r=/\s/,i=e.Pos;e.defineOption("autoCloseBrackets",!1,function(r,i,s){s!=e.Init&&s&&r.removeKeyMap("autoCloseBrackets");if(!i)return;var o=t,f=n;typeof i=="string"?o=i:typeof i=="object"&&(i.pairs!=null&&(o=i.pairs),i.explode!=null&&(f=i.explode));var l=u(o);f&&(l.Enter=a(f)),r.addKeyMap(l)})});