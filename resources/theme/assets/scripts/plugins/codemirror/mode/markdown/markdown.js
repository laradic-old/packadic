(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror"),require("../xml/xml"),require("../meta")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","../xml/xml","../meta"],e):e(CodeMirror)})(function(e){e.defineMode("markdown",function(t,n){function s(n){if(e.findModeByName){var r=e.findModeByName(n);r&&(n=r.mime||r.mimes[0])}var i=e.getMode(t,n);return i.name=="null"?null:i}function O(e,t,n){return t.f=t.inline=n,n(e,t)}function M(e,t,n){return t.f=t.block=n,n(e,t)}function _(e){return e.linkTitle=!1,e.em=!1,e.strong=!1,e.strikethrough=!1,e.quote=0,!r&&e.f==P&&(e.f=I,e.block=D),e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.thisLineHasContent=!1,null}function D(e,t){var r=e.sol(),i=t.list!==!1;t.list!==!1&&t.indentationDiff>=0?(t.indentationDiff<4&&(t.indentation-=t.indentationDiff),t.list=null):t.list!==!1&&t.indentation>0?(t.list=null,t.listDepth=Math.floor(t.indentation/4)):t.list!==!1&&(t.list=!1,t.listDepth=0);var o=null;if(t.indentationDiff>=4)return t.indentation-=4,e.skipToEnd(),a;if(e.eatSpace())return null;if(o=e.match(k))return t.header=o[0].length<=6?o[0].length:6,n.highlightFormatting&&(t.formatting="header"),t.f=t.inline,j(t);if(t.prevLineHasContent&&(o=e.match(L)))return t.header=o[0].charAt(0)=="="?1:2,n.highlightFormatting&&(t.formatting="header"),t.f=t.inline,j(t);if(e.eat(">"))return t.indentation++,t.quote=r?1:t.quote+1,n.highlightFormatting&&(t.formatting="quote"),e.eatSpace(),j(t);if(e.peek()==="[")return O(e,t,z);if(e.match(x,!0))return p;if((!t.prevLineHasContent||i)&&(e.match(T,!1)||e.match(N,!1))){var u=null;return e.match(T,!0)?u="ul":(e.match(N,!0),u="ol"),t.indentation+=4,t.list=!0,t.listDepth++,n.taskLists&&e.match(C,!1)&&(t.taskList=!0),t.f=t.inline,n.highlightFormatting&&(t.formatting=["list","list-"+u]),j(t)}return n.fencedCodeBlocks&&e.match(/^```[ \t]*([\w+#]*)/,!0)?(t.localMode=s(RegExp.$1),t.localMode&&(t.localState=t.localMode.startState()),t.f=t.block=H,n.highlightFormatting&&(t.formatting="code-block"),t.code=!0,j(t)):O(e,t,t.inline)}function P(e,t){var n=i.token(e,t.htmlState);if(r&&t.htmlState.tagStart===null&&!t.htmlState.context||t.md_inside&&e.current().indexOf(">")>-1)t.f=I,t.block=D,t.htmlState=null;return n}function H(e,t){return e.sol()&&e.match("```",!1)?(t.localMode=t.localState=null,t.f=t.block=B,null):t.localMode?t.localMode.token(e,t.localState):(e.skipToEnd(),a)}function B(e,t){e.match("```"),t.block=D,t.f=I,n.highlightFormatting&&(t.formatting="code-block"),t.code=!0;var r=j(t);return t.code=!1,r}function j(e){var t=[];if(e.formatting){t.push(v),typeof e.formatting=="string"&&(e.formatting=[e.formatting]);for(var r=0;r<e.formatting.length;r++)t.push(v+"-"+e.formatting[r]),e.formatting[r]==="header"&&t.push(v+"-"+e.formatting[r]+"-"+e.header),e.formatting[r]==="quote"&&(!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=e.quote?t.push(v+"-"+e.formatting[r]+"-"+e.quote):t.push("error"))}if(e.taskOpen)return t.push("meta"),t.length?t.join(" "):null;if(e.taskClosed)return t.push("property"),t.length?t.join(" "):null;if(e.linkHref)return t.push(b),t.length?t.join(" "):null;e.strong&&t.push(E),e.em&&t.push(w),e.strikethrough&&t.push(S),e.linkText&&t.push(y),e.code&&t.push(a),e.header&&(t.push(u),t.push(u+"-"+e.header)),e.quote&&(t.push(f),!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=e.quote?t.push(f+"-"+e.quote):t.push(f+"-"+n.maxBlockquoteDepth));if(e.list!==!1){var i=(e.listDepth-1)%3;i?i===1?t.push(c):t.push(h):t.push(l)}return e.trailingSpaceNewLine?t.push("trailing-space-new-line"):e.trailingSpace&&t.push("trailing-space-"+(e.trailingSpace%2?"a":"b")),t.length?t.join(" "):null}function F(e,t){return e.match(A,!0)?j(t):undefined}function I(t,r){var s=r.text(t,r);if(typeof s!="undefined")return s;if(r.list)return r.list=null,j(r);if(r.taskList){var u=t.match(C,!0)[1]!=="x";return u?r.taskOpen=!0:r.taskClosed=!0,n.highlightFormatting&&(r.formatting="task"),r.taskList=!1,j(r)}r.taskOpen=!1,r.taskClosed=!1;if(r.header&&t.match(/^#+$/,!0))return n.highlightFormatting&&(r.formatting="header"),j(r);var a=t.sol(),f=t.next();if(f==="\\"){t.next();if(n.highlightFormatting){var l=j(r);return l?l+" formatting-escape":"formatting-escape"}}if(r.linkTitle){r.linkTitle=!1;var c=f;f==="("&&(c=")"),c=(c+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var h="^\\s*(?:[^"+c+"\\\\]+|\\\\\\\\|\\\\.)"+c;if(t.match(new RegExp(h),!0))return b}if(f==="`"){var p=r.formatting;n.highlightFormatting&&(r.formatting="code");var v=j(r),y=t.pos;t.eatWhile("`");var w=1+t.pos-y;return r.code?w===o?(r.code=!1,v):(r.formatting=p,j(r)):(o=w,r.code=!0,j(r))}if(r.code)return j(r);if(f==="!"&&t.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return t.match(/\[[^\]]*\]/),r.inline=r.f=R,d;if(f==="["&&t.match(/.*\](\(.*\)| ?\[.*\])/,!1))return r.linkText=!0,n.highlightFormatting&&(r.formatting="link"),j(r);if(f==="]"&&r.linkText&&t.match(/\(.*\)| ?\[.*\]/,!1)){n.highlightFormatting&&(r.formatting="link");var l=j(r);return r.linkText=!1,r.inline=r.f=R,l}if(f==="<"&&t.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){r.f=r.inline=q,n.highlightFormatting&&(r.formatting="link");var l=j(r);return l?l+=" ":l="",l+m}if(f==="<"&&t.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){r.f=r.inline=q,n.highlightFormatting&&(r.formatting="link");var l=j(r);return l?l+=" ":l="",l+g}if(f==="<"&&t.match(/^\w/,!1)){if(t.string.indexOf(">")!=-1){var E=t.string.substring(1,t.string.indexOf(">"));/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(E)&&(r.md_inside=!0)}return t.backUp(1),r.htmlState=e.startState(i),M(t,r,P)}if(f==="<"&&t.match(/^\/\w*?>/))return r.md_inside=!1,"tag";var S=!1;if(!n.underscoresBreakWords&&f==="_"&&t.peek()!=="_"&&t.match(/(\w)/,!1)){var x=t.pos-2;if(x>=0){var T=t.string.charAt(x);T!=="_"&&T.match(/(\w)/,!1)&&(S=!0)}}if(f==="*"||f==="_"&&!S){if(!a||t.peek()!==" "){if(r.strong===f&&t.eat(f)){n.highlightFormatting&&(r.formatting="strong");var v=j(r);return r.strong=!1,v}if(!r.strong&&t.eat(f))return r.strong=f,n.highlightFormatting&&(r.formatting="strong"),j(r);if(r.em===f){n.highlightFormatting&&(r.formatting="em");var v=j(r);return r.em=!1,v}if(!r.em)return r.em=f,n.highlightFormatting&&(r.formatting="em"),j(r)}}else if(f===" ")if(t.eat("*")||t.eat("_")){if(t.peek()===" ")return j(r);t.backUp(1)}if(n.strikethrough)if(f==="~"&&t.eatWhile(f)){if(r.strikethrough){n.highlightFormatting&&(r.formatting="strikethrough");var v=j(r);return r.strikethrough=!1,v}if(t.match(/^[^\s]/,!1))return r.strikethrough=!0,n.highlightFormatting&&(r.formatting="strikethrough"),j(r)}else if(f===" "&&t.match(/^~~/,!0)){if(t.peek()===" ")return j(r);t.backUp(2)}return f===" "&&(t.match(/ +$/,!1)?r.trailingSpace++:r.trailingSpace&&(r.trailingSpaceNewLine=!0)),j(r)}function q(e,t){var r=e.next();if(r===">"){t.f=t.inline=I,n.highlightFormatting&&(t.formatting="link");var i=j(t);return i?i+=" ":i="",i+m}return e.match(/^[^>]+/,!0),m}function R(e,t){if(e.eatSpace())return null;var r=e.next();return r==="("||r==="["?(t.f=t.inline=U(r==="("?")":"]"),n.highlightFormatting&&(t.formatting="link-string"),t.linkHref=!0,j(t)):"error"}function U(e){return function(t,r){var i=t.next();if(i===e){r.f=r.inline=I,n.highlightFormatting&&(r.formatting="link-string");var s=j(r);return r.linkHref=!1,s}return t.match($(e),!0)&&t.backUp(1),r.linkHref=!0,j(r)}}function z(e,t){return e.match(/^[^\]]*\]:/,!1)?(t.f=W,e.next(),n.highlightFormatting&&(t.formatting="link"),t.linkText=!0,j(t)):O(e,t,I)}function W(e,t){if(e.match(/^\]:/,!0)){t.f=t.inline=X,n.highlightFormatting&&(t.formatting="link");var r=j(t);return t.linkText=!1,r}return e.match(/^[^\]]+/,!0),y}function X(e,t){return e.eatSpace()?null:(e.match(/^[^\s]+/,!0),e.peek()===undefined?t.linkTitle=!0:e.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),t.f=t.inline=I,b)}function $(e){return V[e]||(e=(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),V[e]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+e+")")),V[e]}var r=e.modes.hasOwnProperty("xml"),i=e.getMode(t,r?{name:"xml",htmlMode:!0}:"text/plain");n.highlightFormatting===undefined&&(n.highlightFormatting=!1),n.maxBlockquoteDepth===undefined&&(n.maxBlockquoteDepth=0),n.underscoresBreakWords===undefined&&(n.underscoresBreakWords=!0),n.fencedCodeBlocks===undefined&&(n.fencedCodeBlocks=!1),n.taskLists===undefined&&(n.taskLists=!1),n.strikethrough===undefined&&(n.strikethrough=!1);var o=0,u="header",a="comment",f="quote",l="variable-2",c="variable-3",h="keyword",p="hr",d="tag",v="formatting",m="link",g="link",y="link",b="string",w="em",E="strong",S="strikethrough",x=/^([*\-=_])(?:\s*\1){2,}\s*$/,T=/^[*\-+]\s+/,N=/^[0-9]+\.\s+/,C=/^\[(x| )\](?=\s)/,k=/^#+/,L=/^(?:\={1,}|-{1,})$/,A=/^[^#!\[\]*_\\<>` "'(~]+/,V=[],J={startState:function(){return{f:D,prevLineHasContent:!1,thisLineHasContent:!1,block:D,htmlState:null,indentation:0,inline:I,text:F,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,em:!1,strong:!1,header:0,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1}},copyState:function(t){return{f:t.f,prevLineHasContent:t.prevLineHasContent,thisLineHasContent:t.thisLineHasContent,block:t.block,htmlState:t.htmlState&&e.copyState(i,t.htmlState),indentation:t.indentation,localMode:t.localMode,localState:t.localMode?e.copyState(t.localMode,t.localState):null,inline:t.inline,text:t.text,formatting:!1,linkTitle:t.linkTitle,em:t.em,strong:t.strong,strikethrough:t.strikethrough,header:t.header,taskList:t.taskList,list:t.list,listDepth:t.listDepth,quote:t.quote,trailingSpace:t.trailingSpace,trailingSpaceNewLine:t.trailingSpaceNewLine,md_inside:t.md_inside}},token:function(e,t){t.formatting=!1;if(e.sol()){var n=!!t.header;t.header=0;if(e.match(/^\s*$/,!0)||n)return t.prevLineHasContent=!1,_(t),n?this.token(e,t):null;t.prevLineHasContent=t.thisLineHasContent,t.thisLineHasContent=!0,t.taskList=!1,t.code=!1,t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.f=t.block;var r=e.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,i=Math.floor((r-t.indentation)/4)*4;i>4&&(i=4);var s=t.indentation+i;t.indentationDiff=s-t.indentation,t.indentation=s;if(r>0)return null}return t.f(e,t)},innerMode:function(e){return e.block==P?{state:e.htmlState,mode:i}:e.localState?{state:e.localState,mode:e.localMode}:{state:e,mode:J}},blankLine:_,getType:j,fold:"markdown"};return J},"xml"),e.defineMIME("text/x-markdown","markdown")});