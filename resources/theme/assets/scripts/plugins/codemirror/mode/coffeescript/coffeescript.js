(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){e.defineMode("coffeescript",function(e,t){function r(e){return new RegExp("^(("+e.join(")|(")+"))\\b")}function m(e,t){if(e.sol()){t.scope.align===null&&(t.scope.align=!1);var r=t.scope.offset;if(e.eatSpace()){var f=e.indentation();return f>r&&t.scope.type=="coffee"?"indent":f<r?"dedent":null}r>0&&w(e,t)}if(e.eatSpace())return null;var l=e.peek();if(e.match("####"))return e.skipToEnd(),"comment";if(e.match("###"))return t.tokenize=y,t.tokenize(e,t);if(l==="#")return e.skipToEnd(),"comment";if(e.match(/^-?[0-9\.]/,!1)){var d=!1;e.match(/^-?\d*\.\d+(e[\+\-]?\d+)?/i)&&(d=!0),e.match(/^-?\d+\.\d*/)&&(d=!0),e.match(/^-?\.\d+/)&&(d=!0);if(d)return e.peek()=="."&&e.backUp(1),"number";var m=!1;e.match(/^-?0x[0-9a-f]+/i)&&(m=!0),e.match(/^-?[1-9]\d*(e[\+\-]?\d+)?/)&&(m=!0),e.match(/^-?0(?![\dx])/i)&&(m=!0);if(m)return"number"}if(e.match(h))return t.tokenize=g(e.current(),!1,"string"),t.tokenize(e,t);if(e.match(p)){if(e.current()!="/"||e.match(/^.*\//,!1))return t.tokenize=g(e.current(),!0,"string-2"),t.tokenize(e,t);e.backUp(1)}return e.match(i)||e.match(a)?"operator":e.match(s)?"punctuation":e.match(v)?"atom":e.match(c)?"keyword":e.match(o)?"variable":e.match(u)?"property":(e.next(),n)}function g(e,r,i){return function(s,o){while(!s.eol()){s.eatWhile(/[^'"\/\\]/);if(s.eat("\\")){s.next();if(r&&s.eol())return i}else{if(s.match(e))return o.tokenize=m,i;s.eat(/['"\/]/)}}return r&&(t.singleLineStringErrors?i=n:o.tokenize=m),i}}function y(e,t){while(!e.eol()){e.eatWhile(/[^#]/);if(e.match("###")){t.tokenize=m;break}e.eatWhile("#")}return"comment"}function b(t,n,r){r=r||"coffee";var i=0,s=!1,o=null;for(var u=n.scope;u;u=u.prev)if(u.type==="coffee"||u.type=="}"){i=u.offset+e.indentUnit;break}r!=="coffee"?(s=null,o=t.column()+t.current().length):n.scope.align&&(n.scope.align=!1),n.scope={offset:i,type:r,prev:n.scope,align:s,alignOffset:o}}function w(e,t){if(!t.scope.prev)return;if(t.scope.type==="coffee"){var n=e.indentation(),r=!1;for(var i=t.scope;i;i=i.prev)if(n===i.offset){r=!0;break}if(!r)return!0;while(t.scope.prev&&t.scope.offset!==n)t.scope=t.scope.prev;return!1}return t.scope=t.scope.prev,!1}function E(e,t){var r=t.tokenize(e,t),i=e.current();if(i===".")return r=t.tokenize(e,t),i=e.current(),/^\.[\w$]+$/.test(i)?"variable":n;i==="return"&&(t.dedent=!0),((i==="->"||i==="=>")&&!t.lambda&&!e.peek()||r==="indent")&&b(e,t);var s="[({".indexOf(i);s!==-1&&b(e,t,"])}".slice(s,s+1)),f.exec(i)&&b(e,t),i=="then"&&w(e,t);if(r==="dedent"&&w(e,t))return n;s="])}".indexOf(i);if(s!==-1){while(t.scope.type=="coffee"&&t.scope.prev)t.scope=t.scope.prev;t.scope.type==i&&(t.scope=t.scope.prev)}return t.dedent&&e.eol()&&(t.scope.type=="coffee"&&t.scope.prev&&(t.scope=t.scope.prev),t.dedent=!1),r}var n="error",i=/^(?:->|=>|\+[+=]?|-[\-=]?|\*[\*=]?|\/[\/=]?|[=!]=|<[><]?=?|>>?=?|%=?|&=?|\|=?|\^=?|\~|!|\?|(or|and|\|\||&&|\?)=)/,s=/^(?:[()\[\]{},:`=;]|\.\.?\.?)/,o=/^[_A-Za-z$][_A-Za-z$0-9]*/,u=/^(@|this\.)[_A-Za-z$][_A-Za-z$0-9]*/,a=r(["and","or","not","is","isnt","in","instanceof","typeof"]),f=["for","while","loop","if","unless","else","switch","try","catch","finally","class"],l=["break","by","continue","debugger","delete","do","in","of","new","return","then","this","@","throw","when","until","extends"],c=r(f.concat(l));f=r(f);var h=/^('{3}|\"{3}|['\"])/,p=/^(\/{3}|\/)/,d=["Infinity","NaN","undefined","null","true","false","on","off","yes","no"],v=r(d),S={startState:function(e){return{tokenize:m,scope:{offset:e||0,type:"coffee",prev:null,align:!1},lastToken:null,lambda:!1,dedent:0}},token:function(e,t){var n=t.scope.align===null&&t.scope;n&&e.sol()&&(n.align=!1);var r=E(e,t);return n&&r&&r!="comment"&&(n.align=!0),t.lastToken={style:r,content:e.current()},e.eol()&&e.lambda&&(t.lambda=!1),r},indent:function(e,t){if(e.tokenize!=m)return 0;var n=e.scope,r=t&&"])}".indexOf(t.charAt(0))>-1;if(r)while(n.type=="coffee"&&n.prev)n=n.prev;var i=r&&n.type===t.charAt(0);return n.align?n.alignOffset-(i?1:0):(i?n.prev:n).offset},lineComment:"#",fold:"indent"};return S}),e.defineMIME("text/x-coffeescript","coffeescript")});