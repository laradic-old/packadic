(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed"],e):e(CodeMirror)})(function(e){var t=["template","literal","msg","fallbackmsg","let","if","elseif","else","switch","case","default","foreach","ifempty","for","call","param","deltemplate","delcall","log"];e.defineMode("soy",function(n){function s(e){return e[e.length-1]}function o(e,t,n){var r=e.string,i=n.exec(r.substr(e.pos));i&&(e.string=r.substr(0,e.pos+i.index));var s=e.hideFirstChars(t.indent,function(){return t.localMode.token(e,t.localState)});return e.string=r,s}var r=e.getMode(n,"text/plain"),i={html:e.getMode(n,{name:"text/html",multilineTagIndentFactor:2,multilineTagIndentPastTag:!1}),attributes:r,text:r,uri:r,css:e.getMode(n,"text/css"),js:e.getMode(n,{name:"text/javascript",statementIndent:2*n.indentUnit})};return{startState:function(){return{kind:[],kindTag:[],soyState:[],indent:0,localMode:i.html,localState:e.startState(i.html)}},copyState:function(t){return{tag:t.tag,kind:t.kind.concat([]),kindTag:t.kindTag.concat([]),soyState:t.soyState.concat([]),indent:t.indent,localMode:t.localMode,localState:e.copyState(t.localMode,t.localState)}},token:function(r,u){var a;switch(s(u.soyState)){case"comment":return r.match(/^.*?\*\//)?u.soyState.pop():r.skipToEnd(),"comment";case"variable":if(r.match(/^}/))return u.indent-=2*n.indentUnit,u.soyState.pop(),"variable-2";return r.next(),null;case"tag":if(r.match(/^\/?}/))return u.tag=="/template"||u.tag=="/deltemplate"?u.indent=0:u.indent-=(r.current()=="/}"||t.indexOf(u.tag)==-1?2:1)*n.indentUnit,u.soyState.pop(),"keyword";if(r.match(/^(\w+)(?==)/)){if(r.current()=="kind"&&(a=r.match(/^="([^"]+)/,!1))){var f=a[1];u.kind.push(f),u.kindTag.push(u.tag),u.localMode=i[f]||i.html,u.localState=e.startState(u.localMode)}return"attribute"}if(r.match(/^"/))return u.soyState.push("string"),"string";return r.next(),null;case"literal":if(r.match(/^(?=\{\/literal})/))return u.indent-=n.indentUnit,u.soyState.pop(),this.token(r,u);return o(r,u,/\{\/literal}/);case"string":return r.match(/^.*?"/)?u.soyState.pop():r.skipToEnd(),"string"}return r.match(/^\/\*/)?(u.soyState.push("comment"),"comment"):r.match(r.sol()?/^\s*\/\/.*/:/^\s+\/\/.*/)?"comment":r.match(/^\{\$\w*/)?(u.indent+=2*n.indentUnit,u.soyState.push("variable"),"variable-2"):r.match(/^\{literal}/)?(u.indent+=n.indentUnit,u.soyState.push("literal"),"keyword"):(a=r.match(/^\{([\/@\\]?\w*)/))?(a[1]!="/switch"&&(u.indent+=(/^(\/|(else|elseif|case|default)$)/.test(a[1])&&u.tag!="switch"?1:2)*n.indentUnit),u.tag=a[1],u.tag=="/"+s(u.kindTag)&&(u.kind.pop(),u.kindTag.pop(),u.localMode=i[s(u.kind)]||i.html,u.localState=e.startState(u.localMode)),u.soyState.push("tag"),"keyword"):o(r,u,/\{|\s+\/\/|\/\*/)},indent:function(t,r){var i=t.indent,o=s(t.soyState);if(o=="comment")return e.Pass;if(o=="literal")/^\{\/literal}/.test(r)&&(i-=n.indentUnit);else{if(/^\s*\{\/(template|deltemplate)\b/.test(r))return 0;/^\{(\/|(fallbackmsg|elseif|else|ifempty)\b)/.test(r)&&(i-=n.indentUnit),t.tag!="switch"&&/^\{(case|default)\b/.test(r)&&(i-=n.indentUnit),/^\{\/switch\b/.test(r)&&(i-=n.indentUnit)}return i&&t.localMode.indent&&(i+=t.localMode.indent(t.localState,r)),i},innerMode:function(e){return e.soyState.length&&s(e.soyState)!="literal"?null:{state:e.localState,mode:e.localMode}},electricInput:/^\s*\{(\/|\/template|\/deltemplate|\/switch|fallbackmsg|elseif|else|case|default|ifempty|\/literal\})$/,lineComment:"//",blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",fold:"indent"}},"htmlmixed"),e.registerHelper("hintWords","soy",t.concat(["delpackage","namespace","alias","print","css","debugger"])),e.defineMIME("text/x-soy","soy")});