(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){e.defineMode("ruby",function(e){function t(e){var t={};for(var n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t}function u(e,t,n){return n.tokenize.push(e),e(t,n)}function a(e,t){o=null;if(e.sol()&&e.match("=begin")&&e.eol())return t.tokenize.push(p),"comment";if(e.eatSpace())return null;var n=e.next(),r;if(n=="`"||n=="'"||n=='"')return u(c(n,"string",n=='"'||n=="`"),e,t);if(n=="/"){var i=e.current().length;if(e.skipTo("/")){var a=e.current().length;e.backUp(e.current().length-i);var f=0;while(e.current().length<a){var l=e.next();l=="("?f+=1:l==")"&&(f-=1);if(f<0)break}e.backUp(e.current().length-i);if(f==0)return u(c(n,"string-2",!0),e,t)}return"operator"}if(n=="%"){var d="string",v=!0;e.eat("s")?d="atom":e.eat(/[WQ]/)?d="string":e.eat(/[r]/)?d="string-2":e.eat(/[wxq]/)&&(d="string",v=!1);var m=e.eat(/[^\w\s=]/);return m?(s.propertyIsEnumerable(m)&&(m=s[m]),u(c(m,d,v,!0),e,t)):"operator"}if(n=="#")return e.skipToEnd(),"comment";if(n=="<"&&(r=e.match(/^<-?[\`\"\']?([a-zA-Z_?]\w*)[\`\"\']?(?:;|$)/)))return u(h(r[1]),e,t);if(n=="0")return e.eat("x")?e.eatWhile(/[\da-fA-F]/):e.eat("b")?e.eatWhile(/[01]/):e.eatWhile(/[0-7]/),"number";if(/\d/.test(n))return e.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/),"number";if(n=="?"){while(e.match(/^\\[CM]-/));return e.eat("\\")?e.eatWhile(/\w/):e.next(),"string"}if(n==":")return e.eat("'")?u(c("'","atom",!1),e,t):e.eat('"')?u(c('"',"atom",!0),e,t):e.eat(/[\<\>]/)?(e.eat(/[\<\>]/),"atom"):e.eat(/[\+\-\*\/\&\|\:\!]/)?"atom":e.eat(/[a-zA-Z$@_\xa1-\uffff]/)?(e.eatWhile(/[\w$\xa1-\uffff]/),e.eat(/[\?\!\=]/),"atom"):"operator";if(n=="@"&&e.match(/^@?[a-zA-Z_\xa1-\uffff]/))return e.eat("@"),e.eatWhile(/[\w\xa1-\uffff]/),"variable-2";if(n=="$")return e.eat(/[a-zA-Z_]/)?e.eatWhile(/[\w]/):e.eat(/\d/)?e.eat(/\d/):e.next(),"variable-3";if(/[a-zA-Z_\xa1-\uffff]/.test(n))return e.eatWhile(/[\w\xa1-\uffff]/),e.eat(/[\?\!]/),e.eat(":")?"atom":"ident";if(n!="|"||!t.varList&&t.lastTok!="{"&&t.lastTok!="do"){if(/[\(\)\[\]{}\\;]/.test(n))return o=n,null;if(n=="-"&&e.eat(">"))return"arrow";if(/[=+\-\/*:\.^%<>~|]/.test(n)){var g=e.eatWhile(/[=+\-\/*:\.^%<>~|]/);return n=="."&&!g&&(o="."),"operator"}return null}return o="|",null}function f(e){return e||(e=1),function(t,n){if(t.peek()=="}"){if(e==1)return n.tokenize.pop(),n.tokenize[n.tokenize.length-1](t,n);n.tokenize[n.tokenize.length-1]=f(e-1)}else t.peek()=="{"&&(n.tokenize[n.tokenize.length-1]=f(e+1));return a(t,n)}}function l(){var e=!1;return function(t,n){return e?(n.tokenize.pop(),n.tokenize[n.tokenize.length-1](t,n)):(e=!0,a(t,n))}}function c(e,t,n,r){return function(i,s){var o=!1,u;s.context.type==="read-quoted-paused"&&(s.context=s.context.prev,i.eat("}"));while((u=i.next())!=null){if(u==e&&(r||!o)){s.tokenize.pop();break}if(n&&u=="#"&&!o){if(i.eat("{")){e=="}"&&(s.context={prev:s.context,type:"read-quoted-paused"}),s.tokenize.push(f());break}if(/[@\$]/.test(i.peek())){s.tokenize.push(l());break}}o=!o&&u=="\\"}return t}}function h(e){return function(t,n){return t.match(e)?n.tokenize.pop():t.skipToEnd(),"string"}}function p(e,t){return e.sol()&&e.match("=end")&&e.eol()&&t.tokenize.pop(),e.skipToEnd(),"comment"}var n=t(["alias","and","BEGIN","begin","break","case","class","def","defined?","do","else","elsif","END","end","ensure","false","for","if","in","module","next","not","or","redo","rescue","retry","return","self","super","then","true","undef","unless","until","when","while","yield","nil","raise","throw","catch","fail","loop","callcc","caller","lambda","proc","public","protected","private","require","load","require_relative","extend","autoload","__END__","__FILE__","__LINE__","__dir__"]),r=t(["def","class","case","for","while","module","then","catch","loop","proc","begin"]),i=t(["end","until"]),s={"[":"]","{":"}","(":")"},o;return{startState:function(){return{tokenize:[a],indented:0,context:{type:"top",indented:-e.indentUnit},continuedLine:!1,lastTok:null,varList:!1}},token:function(e,t){e.sol()&&(t.indented=e.indentation());var s=t.tokenize[t.tokenize.length-1](e,t),u,a=o;if(s=="ident"){var f=e.current();s=t.lastTok=="."?"property":n.propertyIsEnumerable(e.current())?"keyword":/^[A-Z]/.test(f)?"tag":t.lastTok=="def"||t.lastTok=="class"||t.varList?"def":"variable",s=="keyword"&&(a=f,r.propertyIsEnumerable(f)?u="indent":i.propertyIsEnumerable(f)?u="dedent":f!="if"&&f!="unless"||e.column()!=e.indentation()?f=="do"&&t.context.indented<t.indented&&(u="indent"):u="indent")}if(o||s&&s!="comment")t.lastTok=a;return o=="|"&&(t.varList=!t.varList),u=="indent"||/[\(\[\{]/.test(o)?t.context={prev:t.context,type:o||s,indented:t.indented}:(u=="dedent"||/[\)\]\}]/.test(o))&&t.context.prev&&(t.context=t.context.prev),e.eol()&&(t.continuedLine=o=="\\"||s=="operator"),s},indent:function(t,n){if(t.tokenize[t.tokenize.length-1]!=a)return 0;var r=n&&n.charAt(0),i=t.context,o=i.type==s[r]||i.type=="keyword"&&/^(?:end|until|else|elsif|when|rescue)\b/.test(n);return i.indented+(o?0:e.indentUnit)+(t.continuedLine?e.indentUnit:0)},electricChars:"}de",lineComment:"#"}}),e.defineMIME("text/x-ruby","ruby")});