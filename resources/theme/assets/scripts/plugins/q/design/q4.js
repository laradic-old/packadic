var isPromise=function(e){return e&&typeof e.then=="function"},defer=function(){var e=[],t;return{resolve:function(n){if(e){t=ref(n);for(var r=0,i=e.length;r<i;r++){var s=e[r];t.then(s)}e=undefined}},promise:{then:function(n){var r=defer(),i=function(e){r.resolve(n(e))};return e?e.push(i):t.then(i),r.promise}}}},ref=function(e){return e&&typeof e.then=="function"?e:{then:function(t){return ref(t(e))}}};