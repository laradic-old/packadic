(function(e,t){var n,r,i;e("client/api.js unit tests - constructor and bridge",{setup:function(){i=ZeroClipboard.isFlashUnusable,r=ZeroClipboard.config(),ZeroClipboard.isFlashUnusable=function(){return!1},ZeroClipboard.config({swfPath:r.swfPath.replace(/\/(?:src|test)\/.*$/i,"/dist/ZeroClipboard.swf")})},teardown:function(){ZeroClipboard.destroy(),ZeroClipboard.isFlashUnusable=i,ZeroClipboard.config(r)}}),t("Client is created properly by `ZeroClipboard`",function(e){e.expect(3);var t=new ZeroClipboard;e.ok(t),e.ok(t.id),e.strictEqual(t instanceof ZeroClipboard,!0)}),t("New client is not the same client (no singleton) but does share the same bridge",function(e){e.expect(6);var t="."+ZeroClipboard.config("containerClass");e.strictEqual($(t).length,0);var n=new ZeroClipboard;e.ok(n.id),e.strictEqual($(t).length,1);var r=new ZeroClipboard;e.strictEqual($(t).length,1),e.notEqual(r.id,n.id),e.notEqual(r,n)}),t("No more client singleton!",function(e){e.expect(7),ZeroClipboard.isFlashUnusable=function(){return!1},e.ok(!ZeroClipboard.prototype._singleton,"The client singleton does not exist on the prototype before creating a client");var t=new ZeroClipboard;e.ok(!ZeroClipboard.prototype._singleton,"The client singleton does not exist on the prototype after creating a client"),e.ok(!t._singleton,"The client singleton does not exist on the client instance after creating a client");var n=new ZeroClipboard;e.ok(!ZeroClipboard.prototype._singleton,"The client singleton does not exist on the prototype after creating a second client"),e.ok(!t._singleton,"The client singleton does not exist on the first client instance after creating a second client"),e.ok(!n._singleton,"The client singleton does not exist on the second client instance after creating a second client"),ZeroClipboard.destroy(),e.ok(!ZeroClipboard.prototype._singleton,"The client singleton does not exist on the prototype after calling `destroy`")}),t("`destroy` clears up the client",function(e){e.expect(6);var t="#"+ZeroClipboard.config("containerId");ZeroClipboard.isFlashUnusable=function(){return!1},e.ok(!ZeroClipboard.prototype._singleton,"The client singleton does not exist before creating a client"),e.equal($(t)[0],null,"The HTML bridge does not exist before creating a client"),new ZeroClipboard,e.ok(!ZeroClipboard.prototype._singleton,"The client singleton does exist after creating a client"),e.notEqual($(t)[0],null,"The HTML bridge does exist after creating a client"),ZeroClipboard.destroy(),e.ok(!ZeroClipboard.prototype._singleton,"The client singleton does not exist after calling `destroy`"),e.equal($(t)[0],null,"The HTML bridge does not exist after calling `destroy`")}),e("client/api.js unit tests - clipboard",{setup:function(){r=ZeroClipboard.config(),ZeroClipboard.config({swfPath:r.swfPath.replace(/\/(?:src|test)\/.*$/i,"/dist/ZeroClipboard.swf")})},teardown:function(){ZeroClipboard.destroy(),ZeroClipboard.config(r)}}),t("`setText` works",function(e){e.expect(4);var t=new ZeroClipboard;e.deepEqual(_clipData,{},"`_clipData` is empty"),t.setText("zc4evar"),e.deepEqual(_clipData,{"text/plain":"zc4evar"},"`_clipData` contains expected text"),t.setText("ZeroClipboard"),e.deepEqual(_clipData,{"text/plain":"ZeroClipboard"},"`_clipData` contains expected updated text"),_clipData["text/html"]="<b>Win</b>",t.setText("goodbye"),e.deepEqual(_clipData,{"text/plain":"goodbye","text/html":"<b>Win</b>"},"`_clipData` contains expected updated text AND the other data")}),t("`setHtml` works",function(e){e.expect(4);var t=new ZeroClipboard;e.deepEqual(_clipData,{},"`_clipData` is empty"),t.setHtml("zc4evar"),e.deepEqual(_clipData,{"text/html":"zc4evar"},"`_clipData` contains expected HTML"),t.setHtml("<b>ZeroClipboard</b>"),e.deepEqual(_clipData,{"text/html":"<b>ZeroClipboard</b>"},"`_clipData` contains expected updated HTML"),_clipData["text/plain"]="blah",t.setHtml("<i>goodbye</i>"),e.deepEqual(_clipData,{"text/html":"<i>goodbye</i>","text/plain":"blah"},"`_clipData` contains expected updated HTML AND the other data")}),t("`setRichText` works",function(e){e.expect(4);var t=new ZeroClipboard;e.deepEqual(_clipData,{},"`_clipData` is empty"),t.setRichText("zc4evar"),e.deepEqual(_clipData,{"application/rtf":"zc4evar"},"`_clipData` contains expected RTF"),t.setRichText("{\\rtf1\\ansi\n{\\b ZeroClipboard}}"),e.deepEqual(_clipData,{"application/rtf":"{\\rtf1\\ansi\n{\\b ZeroClipboard}}"},"`_clipData` contains expected updated RTF"),_clipData["text/plain"]="blah",t.setRichText("{\\rtf1\\ansi\n{\\i Foo}}"),e.deepEqual(_clipData,{"application/rtf":"{\\rtf1\\ansi\n{\\i Foo}}","text/plain":"blah"},"`_clipData` contains expected updated RTF AND the other data")}),t("`setData` works",function(e){e.expect(4);var t=new ZeroClipboard;e.deepEqual(_clipData,{},"`_clipData` is empty"),t.setData("text/plain","zc4evar"),e.deepEqual(_clipData,{"text/plain":"zc4evar"},"`_clipData` contains expected text"),t.setData("text/html","<i>ZeroClipboard</i>"),e.deepEqual(_clipData,{"text/plain":"zc4evar","text/html":"<i>ZeroClipboard</i>"},"`_clipData` contains expected text and custom format"),t.setData({"text/html":"<b>Win</b>"}),e.deepEqual(_clipData,{"text/html":"<b>Win</b>"},"`_clipData` contains expected HTML and cleared out old data because an object was passed in")}),t("`clearData` works",function(e){e.expect(4);var t=new ZeroClipboard;e.deepEqual(_clipData,{},"`_clipData` is empty"),_clipData["text/plain"]="zc4evar",_clipData["application/rtf"]="{\\rtf1\\ansi\n{\\i Foo}}",_clipData["text/html"]="<b>Win</b>",e.deepEqual(_clipData,{"text/plain":"zc4evar","application/rtf":"{\\rtf1\\ansi\n{\\i Foo}}","text/html":"<b>Win</b>"},"`_clipData` contains all expected data"),t.clearData("application/rtf"),e.deepEqual(_clipData,{"text/plain":"zc4evar","text/html":"<b>Win</b>"},"`_clipData` had 'application/rtf' successfully removed"),t.clearData(),e.deepEqual(_clipData,{},"`_clipData` had all data successfully removed")}),t("`setText` overrides the data-clipboard-text attribute",function(e){e.expect(3);var t=new ZeroClipboard,n=document.getElementById("d_clip_button");t.clip(n),t.setText("This is the new text"),ZeroClipboard.activate(n);var r=ZeroClipboard.emit("copy");e.deepEqual(_clipData,{"text/plain":"This is the new text"}),e.deepEqual(r,{text:"This is the new text"}),e.deepEqual(_clipDataFormatMap,{text:"text/plain"})}),t("`setText` overrides data-clipboard-target pre",function(e){e.expect(3);var t=new ZeroClipboard,n=document.getElementById("d_clip_button_pre_text");t.clip(n),t.setText("This is the new text"),ZeroClipboard.activate(n);var r=ZeroClipboard.emit("copy");e.deepEqual(_clipData,{"text/plain":"This is the new text"}),e.deepEqual(r,{text:"This is the new text"}),e.deepEqual(_clipDataFormatMap,{text:"text/plain"})}),t("`setHtml` overrides data-clipboard-target pre",function(e){e.expect(3);var t=new ZeroClipboard,n=document.getElementById("d_clip_button_pre_text");t.clip(n),t.setHtml("This is the new HTML"),ZeroClipboard.activate(n);var r=ZeroClipboard.emit("copy");e.deepEqual(_clipData,{"text/html":"This is the new HTML"}),e.deepEqual(r,{html:"This is the new HTML"}),e.deepEqual(_clipDataFormatMap,{html:"text/html"})}),t("`setText` AND `setHtml` override data-clipboard-target pre",function(e){e.expect(3);var t=new ZeroClipboard,n=document.getElementById("d_clip_button_pre_text");t.clip(n),t.setText("This is the new text"),t.setHtml("This is the new HTML"),ZeroClipboard.activate(n);var r=ZeroClipboard.emit("copy");e.deepEqual(_clipData,{"text/plain":"This is the new text","text/html":"This is the new HTML"}),e.deepEqual(r,{text:"This is the new text",html:"This is the new HTML"}),e.deepEqual(_clipDataFormatMap,{text:"text/plain",html:"text/html"})}),e("client/api.js unit tests - event",{setup:function(){n=_extend({},_flashState),r=ZeroClipboard.config(),i=ZeroClipboard.isFlashUnusable,_currentElement=null,_flashState={bridge:null,version:"0.0.0",disabled:null,outdated:null,unavailable:null,deactivated:null,ready:null}},teardown:function(){ZeroClipboard.destroy(),_currentElement=null,_flashState=n,ZeroClipboard.config(r),ZeroClipboard.isFlashUnusable=i}}),t("Clip element after new client",function(e){e.expect(4);var t=new ZeroClipboard,n=document.getElementById("d_clip_button");e.strictEqual("zcClippingId"in n,!1),e.deepEqual(t.elements(),[]),t.clip(n),e.strictEqual("zcClippingId"in n,!0),e.deepEqual(t.elements(),[n])}),t("unclip element removes items",function(e){e.expect(12);var t=new ZeroClipboard,n=[document.getElementById("d_clip_button"),document.getElementById("d_clip_button2"),document.getElementById("d_clip_button3")];e.strictEqual("zcClippingId"in n[0],!1),e.strictEqual("zcClippingId"in n[1],!1),e.strictEqual("zcClippingId"in n[2],!1),e.deepEqual(t.elements(),[]),t.clip(n),e.strictEqual("zcClippingId"in n[0],!0),e.strictEqual("zcClippingId"in n[1],!0),e.strictEqual("zcClippingId"in n[2],!0),e.deepEqual(t.elements(),n),t.unclip([document.getElementById("d_clip_button3"),document.getElementById("d_clip_button2")]),e.strictEqual("zcClippingId"in n[0],!0),e.strictEqual("zcClippingId"in n[1],!1),e.strictEqual("zcClippingId"in n[2],!1),e.deepEqual(t.elements(),[n[0]])}),t("Element won't be clipped twice",function(e){e.expect(3);var t=new ZeroClipboard,n=document.getElementById("d_clip_button");e.deepEqual(t.elements(),[]),t.clip(n),e.deepEqual(t.elements(),[n]),t.clip(n),e.deepEqual(t.elements(),[n])}),t("Registering Events",function(e){e.expect(6);var t=new ZeroClipboard;t.on("ready",function(){}),t.on("onError",function(){}),t.on("onCustomEvent",function(){}),e.ok(t.handlers().ready),e.ok(t.handlers().error),e.ok(t.handlers().customevent),e.strictEqual(t.handlers().ready.length,1),e.strictEqual(t.handlers().error.length,1),e.strictEqual(t.handlers().customevent.length,1)}),t("Registering Events with Maps",function(e){e.expect(6);var t=new ZeroClipboard;t.on({ready:function(){},onError:function(){},onCustomEvent:function(){}}),e.ok(t.handlers().ready),e.ok(t.handlers().error),e.ok(t.handlers().customevent),e.strictEqual(t.handlers().ready.length,1),e.strictEqual(t.handlers().error.length,1),e.strictEqual(t.handlers().customevent.length,1)}),t("Unregistering Events",function(e){e.expect(6);var t=new ZeroClipboard,n=function(){},r=function(){},i=function(){};t.on("ready",n),t.on("onError",r),t.on("onCustomEvent",i),e.deepEqual(t.handlers().ready,[n]),e.deepEqual(t.handlers().error,[r]),e.deepEqual(t.handlers().customevent,[i]),t.off("ready",n),e.deepEqual(t.handlers().ready,[]),t.off("onError",r),e.deepEqual(t.handlers().error,[]),t.off("onCustomEvent",i),e.deepEqual(t.handlers().customevent,[])}),t("Unregistering Events with Maps",function(e){e.expect(6);var t=new ZeroClipboard,n=function(){},r=function(){},i=function(){};t.on("ready",n),t.on("onError",r),t.on("onCustomEvent",i),e.deepEqual(t.handlers().ready,[n]),e.deepEqual(t.handlers().error,[r]),e.deepEqual(t.handlers().customevent,[i]),t.off({ready:n}),e.deepEqual(t.handlers().ready,[]),t.off({onError:r}),e.deepEqual(t.handlers().error,[]),t.off({onCustomEvent:i}),e.deepEqual(t.handlers().customevent,[])}),t("Registering two events works",function(e){e.expect(6);var t=new ZeroClipboard;e.ok(!t.handlers().ready),e.ok(!t.handlers().aftercopy),t.on("ready onaftercopy",function(){}),e.ok(t.handlers().ready),e.ok(t.handlers().aftercopy),e.strictEqual(t.handlers().ready.length,1),e.strictEqual(t.handlers().aftercopy.length,1)}),t("Registering two events with a map works",function(e){e.expect(6);var t=new ZeroClipboard;e.ok(!t.handlers().ready),e.ok(!t.handlers().aftercopy),t.on({"ready onaftercopy":function(){}}),e.ok(t.handlers().ready),e.ok(t.handlers().aftercopy),e.strictEqual(t.handlers().ready.length,1),e.strictEqual(t.handlers().aftercopy.length,1)}),t("Unregistering two events works",function(e){e.expect(6);var t=new ZeroClipboard,n=function(){};e.ok(!t.handlers().ready),e.ok(!t.handlers().aftercopy),t.on("ready onaftercopy",n),e.deepEqual(t.handlers().ready,[n]),e.deepEqual(t.handlers().aftercopy,[n]),t.off("ready onaftercopy",n),e.deepEqual(t.handlers().ready,[]),e.deepEqual(t.handlers().aftercopy,[])}),t("Unregistering two events with a map works",function(e){e.expect(6);var t=new ZeroClipboard,n=function(){};e.ok(!t.handlers().ready),e.ok(!t.handlers().aftercopy),t.on("ready onaftercopy",n),e.deepEqual(t.handlers().ready,[n]),e.deepEqual(t.handlers().aftercopy,[n]),t.off({"ready onaftercopy":n}),e.deepEqual(t.handlers().ready,[]),e.deepEqual(t.handlers().aftercopy,[])}),t("`on` can add multiple handlers for the same event",function(e){e.expect(3);var t=new ZeroClipboard,n=function(){},r=function(){};e.ok(!t.handlers().ready),t.on("ready",n),e.deepEqual(t.handlers().ready,[n]),t.on("ready",r),e.deepEqual(t.handlers().ready,[n,r])}),t("`off` can remove multiple handlers for the same event",function(e){e.expect(5);var t=new ZeroClipboard,n=function(){},r=function(){},i=function(){};e.ok(!t.handlers().ready),t.on("ready",n),t.on("ready",r),t.on("ready",i),e.deepEqual(t.handlers().ready,[n,r,i]),t.off("ready",i),e.deepEqual(t.handlers().ready,[n,r]),t.off("ready",n),e.deepEqual(t.handlers().ready,[r]),t.off("ready",r),e.deepEqual(t.handlers().ready,[])}),t("`on` can add more than one entry of the same handler function for the same event",function(e){e.expect(2);var t=new ZeroClipboard,n=function(){};e.ok(!t.handlers().ready),t.on("ready",n),t.on("ready",n),e.deepEqual(t.handlers().ready,[n,n])}),t("`off` will remove all entries of the same handler function for the same event",function(e){e.expect(3);var t=new ZeroClipboard,n=function(){};e.ok(!t.handlers().ready),t.on("ready",n),t.on("ready",n),e.deepEqual(t.handlers().ready,[n,n]),t.off("ready",n),e.deepEqual(t.handlers().ready,[])}),t("`off` will remove all handler functions for an event if no function is specified",function(e){e.expect(3);var t=new ZeroClipboard,n=function(){},r=function(){},i=function(){};e.ok(!t.handlers().ready),t.on("ready",n),t.on("ready",r),t.on("ready",i),t.on("ready",n),e.deepEqual(t.handlers().ready,[n,r,i,n]),t.off("ready"),e.deepEqual(t.handlers().ready,[])}),t("`off` will remove all handler functions for all events if no event type is specified",function(e){e.expect(6);var t=new ZeroClipboard,n=function(){},r=function(){},i=function(){};e.ok(!t.handlers().ready),e.ok(!t.handlers().error),t.on("ready",n),t.on("ready",r),t.on("error",i),e.deepEqual(t.handlers().ready,[n,r]),e.deepEqual(t.handlers().error,[i]),t.off(),e.deepEqual(t.handlers().ready,[]),e.deepEqual(t.handlers().error,[])}),t("Test disabledFlash Event",function(e){e.expect(6),_flashState.disabled=!0;var t=new ZeroClipboard,n=t.id;t.on("error",function(r){e.strictEqual(this,t),e.strictEqual(this.id,n),e.strictEqual(_flashState.disabled,!0),e.strictEqual(r.type,"error"),e.strictEqual(r.name,"flash-disabled"),e.strictEqual(r.target,null),QUnit.start()}),QUnit.stop()}),t("Test outdatedFlash Event",function(e){e.expect(8),_flashState.disabled=!1,_flashState.outdated=!0,_flashState.version="10.0.0";var t=new ZeroClipboard,n=t.id;t.on("ready",function(){e.ok(!1,"The `ready` event should NOT have fired!")}),t.on("error",function(r){e.strictEqual(this,t),e.strictEqual(this.id,n),e.strictEqual(_flashState.outdated,!0),e.strictEqual(r.type,"error"),e.strictEqual(r.name,"flash-outdated"),e.strictEqual(r.target,null),e.strictEqual(r.version,"10.0.0"),e.strictEqual(r.minimumVersion,"11.0.0"),QUnit.start()}),QUnit.stop()}),t("Test deactivatedFlash Event",function(e){e.expect(10),_flashState.disabled=!1,_flashState.outdated=!1,_flashState.version="11.0.0",ZeroClipboard.config({flashLoadTimeout:2e3});var t=new ZeroClipboard,n=t.id;t.on("ready",function(){e.ok(!1,"The `ready` event should NOT have fired!")}),t.on("error",function(r){e.strictEqual(this,t),e.strictEqual(this.id,n),e.strictEqual(_flashState.deactivated,!0),e.strictEqual(_flashState.ready,!1),e.strictEqual(r.type,"error"),e.strictEqual(r.name,"flash-deactivated"),e.strictEqual(r.target,null),e.strictEqual(r.version,"11.0.0"),e.strictEqual(r.minimumVersion,"11.0.0"),QUnit.start()}),setTimeout(function(){e.strictEqual(_flashState.deactivated,null)},500),QUnit.stop()}),t("Test deactivatedFlash Event after first resolution",function(e){e.expect(8),_flashState.disabled=!1,_flashState.outdated=!1,_flashState.version="11.0.0",_flashState.deactivated=!0;var t=new ZeroClipboard,n=t.id;t.on("ready",function(){e.ok(!1,"The `ready` event should NOT have fired!")}),t.on("error",function(r){e.strictEqual(this,t),e.strictEqual(this.id,n),e.strictEqual(_flashState.deactivated,!0),e.strictEqual(r.type,"error"),e.strictEqual(r.name,"flash-deactivated"),e.strictEqual(r.target,null),e.strictEqual(r.version,"11.0.0"),e.strictEqual(r.minimumVersion,"11.0.0"),QUnit.start()}),QUnit.stop()}),t("Test ready Event",function(e){e.expect(6),_flashState.disabled=!1,_flashState.outdated=!1,_flashState.version="11.9.0";var t=new ZeroClipboard,n=document.getElementById("d_clip_button"),r=t.id;t.clip(n),t.on("ready",function(n){e.strictEqual(this,t),e.strictEqual(this.id,r),e.strictEqual(n.type,"ready"),e.strictEqual(n.target,null),e.strictEqual(_flashState.deactivated,!1),e.strictEqual(n.version,"11.9.0"),QUnit.start()}),QUnit.stop(),ZeroClipboard.emit("ready")}),t("Test ready Event after first load",function(e){e.expect(6),_flashState.disabled=!1,_flashState.outdated=!1,_flashState.deactivated=!1,_flashState.version="11.9.0",_flashState.ready=!0,_flashState.bridge={};var t=new ZeroClipboard,n=t.id;t.on("ready",function(r){e.strictEqual(this,t),e.strictEqual(this.id,n),e.strictEqual(r.type,"ready"),e.strictEqual(r.target,null),e.strictEqual(_flashState.deactivated,!1),e.strictEqual(r.version,"11.9.0"),QUnit.start()}),QUnit.stop()}),t("Test overdueFlash Event",function(e){e.expect(15),_flashState.disabled=!1,_flashState.outdated=!1,_flashState.version="11.0.0",_flashState.deactivated=!0;var t=new ZeroClipboard,n=t.id;t.on("ready",function(){e.ok(!1,"The `ready` event should NOT have fired!")}),t.on("error",function(r){e.strictEqual(this,t),e.strictEqual(this.id,n),r.name==="flash-deactivated"?(e.strictEqual(r.type,"error"),e.strictEqual(r.name,"flash-deactivated"),e.strictEqual(_flashState.deactivated,!0),e.strictEqual(r.version,"11.0.0"),e.strictEqual(r.minimumVersion,"11.0.0")):r.name==="flash-overdue"&&(e.strictEqual(r.type,"error"),e.strictEqual(r.name,"flash-overdue"),e.strictEqual(_flashState.deactivated,!1),e.strictEqual(_flashState.overdue,!0),e.strictEqual(r.version,"11.0.0"),e.strictEqual(r.minimumVersion,"11.0.0"),QUnit.start())}),QUnit.stop(),setTimeout(function(){ZeroClipboard.emit("ready")},1e3)}),t("Test string function name as handler",function(e){e.expect(2);var t=new ZeroClipboard,n=document.getElementById("d_clip_button"),r=t.id;t.clip(n),window.zcLoadCallback=function(t){e.strictEqual(this.id,r),e.strictEqual(t.type,"ready"),QUnit.start(),delete window.zcLoadCallback},t.on("ready","zcLoadCallback"),QUnit.stop(),ZeroClipboard.emit("ready")}),t("Test EventListener object as handler",function(e){e.expect(4);var t=new ZeroClipboard,n=document.getElementById("d_clip_button"),r=t.id;t.clip(n);var i={handleEvent:function(n){e.strictEqual(n.type,"ready"),e.strictEqual(n.client,t),e.strictEqual(n.client.id,r),e.strictEqual(this,i),QUnit.start()}};t.on("ready",i),QUnit.stop(),ZeroClipboard.emit("ready")}),t("Test for appropriate context inside of invoked event handlers",function(e){e.expect(12);var t=new ZeroClipboard,n=document.getElementById("d_clip_button");e.ok(n),e.strictEqual(n.id,"d_clip_button"),t.clip(n),ZeroClipboard.activate(n),t.on("ready error",function(){e.strictEqual(this,t)}),t.on("beforecopy",function(t){e.strictEqual(t.target,n)}),t.on("copy",function(t){e.strictEqual(t.target,n),e.ok(_clipData["text/plain"])}),t.on("aftercopy",function(t){e.strictEqual(t.target,n),e.ok(!_clipData["text/plain"]),QUnit.start()}),QUnit.stop(),ZeroClipboard.emit("ready"),ZeroClipboard.emit({type:"error",name:"flash-disabled"}),ZeroClipboard.emit({type:"error",name:"flash-outdated"}),ZeroClipboard.emit({type:"error",name:"flash-deactivated"}),ZeroClipboard.emit({type:"error",name:"flash-overdue"}),ZeroClipboard.emit("beforecopy"),ZeroClipboard.emit("copy"),ZeroClipboard.emit("aftercopy")}),e("client/api.js unit tests - element clipping",{setup:function(){r=ZeroClipboard.config(),ZeroClipboard.config({swfPath:r.swfPath.replace(/\/(?:src|test)\/.*$/i,"/dist/ZeroClipboard.swf")})},teardown:function(){ZeroClipboard.destroy(),ZeroClipboard.config(r)}}),t("Client without selector doesn't have elements",function(e){e.expect(2);var t=new ZeroClipboard;e.ok(t),e.deepEqual(t.elements(),[])})})(QUnit.module,QUnit.test);