(function(e,t){var n,r,i;e("core/private.js unit tests - utils"),t("`_getStyle` returns computed styles",function(e){e.expect(5);var t=$("a.no_cursor_style")[0],n=$("a.no_pointer_anchor")[0],r=$(".zindex-auto")[0],i=$("#d_clip_button")[0],s=$(".big-border")[0],o=_getStyle(t,"cursor"),u=_getStyle(n,"cursor"),a=_getStyle(r,"z-index"),f=_getStyle(i,"border-left-width"),l=_getStyle(s,"border-left-width");e.strictEqual(o,"pointer"),e.notStrictEqual(u,"pointer"),e.strictEqual(/^(?:auto|0)$/.test(a),!0),e.strictEqual(/^[0-3]px$/.test(f),!0),e.strictEqual(l,"10px")}),t("`_removeClass` removes classes from element",function(e){e.expect(5);var t=$("<div></div>").addClass("class1 class-2 class_3")[0];_removeClass(t,"class1"),e.strictEqual(t.className,"class-2 class_3"),_removeClass(t,"classd"),e.strictEqual(t.className,"class-2 class_3"),_removeClass(t,"class-2"),e.strictEqual(t.className,"class_3"),_removeClass(t,"class_3"),e.strictEqual(t.className,""),_removeClass(t,"class-3"),e.strictEqual(t.className,""),t=null}),t("`_removeClass` doesn't remove partial class names",function(e){e.expect(3);var t=$("<div></div>").addClass("class1 class-2 class_3")[0];_removeClass(t,"ass"),e.strictEqual(t.className,"class1 class-2 class_3"),_removeClass(t,"-2"),e.strictEqual(t.className,"class1 class-2 class_3"),_removeClass(t,"_3"),e.strictEqual(t.className,"class1 class-2 class_3"),t=null}),t("`_addClass` adds a class name",function(e){e.expect(4);var t=$("<div></div>")[0];_addClass(t,"class1"),e.strictEqual(t.className,"class1"),_addClass(t,"class-2"),e.strictEqual(t.className,"class1 class-2"),_addClass(t,"class_3"),e.strictEqual(t.className,"class1 class-2 class_3"),_addClass(t,"class_3"),e.strictEqual(t.className,"class1 class-2 class_3"),t=null}),t("`_vars` builds FlashVars",function(e){e.expect(6);var t={},n={trustedDomains:["*"]},r={forceEnhancedClipboard:!1},i={forceEnhancedClipboard:!0},s={trustedDomains:["*"],forceEnhancedClipboard:!1},o={trustedDomains:["*"],forceEnhancedClipboard:!0};e.strictEqual(_vars(t),""),e.strictEqual(_vars(n),"trustedOrigins=*"),e.strictEqual(_vars(r),""),e.strictEqual(_vars(i),"forceEnhancedClipboard=true"),e.strictEqual(_vars(s),"trustedOrigins=*"),e.strictEqual(_vars(o),"trustedOrigins=*&forceEnhancedClipboard=true")}),t("`_cacheBust` adds cache-buster appropriately",function(e){e.expect(2);var t="path.com/z.swf",n="path.com/z.swf?q=jon";e.strictEqual(_cacheBust(t).indexOf("?noCache="),0),e.strictEqual(_cacheBust(n).indexOf("&noCache="),0)}),t("`_cacheBust` can be disabled",function(e){e.expect(2);var t="path.com/z.swf",n="path.com/z.swf?q=jon",r={cacheBust:!1};e.strictEqual(_cacheBust(t,r),""),e.strictEqual(_cacheBust(n,r),"")}),t("`_extractDomain` extracts domains from origins and URLs",function(e){e.expect(20);var t={"":null," ":null,"ZeroClipboard.swf":null,"js/ZeroClipboard.swf":null,"/js/ZeroClipboard.swf":null,"/zeroclipboard/zeroclipboard/":null,"zeroclipboard/zeroclipboard/":null,"*":"*","github.com":"github.com","http://github.com":"github.com","https://github.com":"github.com","github.com:80":"github.com:80","http://github.com:80":"github.com:80","https://github.com:443":"github.com:443","http://github.com/zeroclipboard/zeroclipboard/":"github.com","https://github.com/zeroclipboard/zeroclipboard/":"github.com","http://github.com:80/zeroclipboard/zeroclipboard/":"github.com:80","https://github.com:443/zeroclipboard/zeroclipboard/":"github.com:443"};e.strictEqual(_extractDomain(undefined),null,"Processing: `undefined`"),e.strictEqual(_extractDomain(null),null,"Processing: `null`");for(var n in t)t.hasOwnProperty(n)&&e.strictEqual(_extractDomain(n),t[n],'Processing: "'+n+'"')}),t("`_determineScriptAccess` determines the appropriate script access level",function(e){var t,n,r,i=window.location.host||"localhost",s={swfPath:"ZeroClipboard.swf",trustedDomains:[i]},o=[{args:[i,s],result:"sameDomain"},{args:[i,_extend({},s,{trustedDomains:[]})],result:"never"},{args:[i,_extend({},s,{trustedDomains:["*"]})],result:"always"},{args:[i,_extend({},s,{trustedDomains:[i,"otherDomain.com"]})],result:"always"},{args:[i,_extend({},s,{trustedDomains:["otherDomain.com"]})],result:"never"},{args:[i,_extend({},s,{swfPath:"//otherDomain.com/ZeroClipboard.swf"})],result:"always"},{args:[i,_extend({},s,{swfPath:"//otherDomain.com/ZeroClipboard.swf",trustedDomains:[]})],result:"never"},{args:[i,_extend({},s,{swfPath:"//otherDomain.com/ZeroClipboard.swf",trustedDomains:["*"]})],result:"always"},{args:[i,_extend({},s,{swfPath:"//otherDomain.com/ZeroClipboard.swf",trustedDomains:[i,"otherDomain.com"]})],result:"always"}];e.expect(9);for(t=0,n=o.length;t<n;t++)r=o[t],e.strictEqual(_determineScriptAccess.apply(this,r.args),r.result,"Processing: "+JSON.stringify(r))}),t("`_mapClipDataToFlash` works",function(e){e.expect(1);var t={"text/plain":"Zero","text/html":"<b>Zero</b>"},n={data:{text:"Zero",html:"<b>Zero</b>"},formatMap:{text:"text/plain",html:"text/html"}},r=_mapClipDataToFlash(t);e.deepEqual(r,n,"Converted keys to Flash-friendly names and provided a format map")}),t("`_mapClipResultsFromFlash` works",function(e){e.expect(2);var t={type:"aftercopy",success:{text:!0,html:!1},data:{text:"Zero",html:"<b>Zero</b>"}},n={text:"text/plain",html:"text/html"},r={type:"aftercopy",success:{"text/plain":!0,"text/html":!1},data:{"text/plain":"Zero","text/html":"<b>Zero</b>"}},i=_mapClipResultsFromFlash(t,null);e.deepEqual(i,t,"Should return the original object if it cannot map it");var s=_mapClipResultsFromFlash(t,n);e.deepEqual(s,r,"Should reverse the key mapping process")}),t("`_createEvent` works",function(e){e.expect(2);var t=_createEvent("ready");e.strictEqual(typeof t=="object"&&t!=null,!0,"Returns non-null object"),e.strictEqual(t.type,"ready","Object has a `type` property of 'ready'")}),t("`_copyTarget` element is handled appropriately",function(e){e.expect(18);var t=$("#d_clip_button")[0],n=$("#goodTargetId")[0];_currentElement=t,_copyTarget=null;var r=_createEvent("beforecopy");_preprocessEvent(r),e.strictEqual(_currentElement,t,"`_currentElement` is 'el1'"),e.strictEqual(_copyTarget,t,"`_copyTarget` is 'el1'"),e.strictEqual(r.target,t,"`beforecopy` target is 'el1'"),_currentElement=n,r=_createEvent("copy"),_preprocessEvent(r),e.strictEqual(_currentElement,n,"`_currentElement` is 'el2'"),e.strictEqual(_copyTarget,t,"`_copyTarget` is 'el1'"),e.strictEqual(r.target,t,"`copy` target is 'el1'"),r=_createEvent("_mouseover"),_preprocessEvent(r),e.strictEqual(_currentElement,n,"`_currentElement` is 'el2'"),e.strictEqual(_copyTarget,t,"`_copyTarget` is 'el1'"),e.strictEqual(r.target,n,"`_mouseover` target is 'el2'"),r=_createEvent("aftercopy"),_preprocessEvent(r),e.strictEqual(_currentElement,n,"`_currentElement` is 'el2'"),e.strictEqual(_copyTarget,t,"`_copyTarget` is 'el1'"),e.strictEqual(r.target,t,"`aftercopy` target is 'el1'"),r=_createEvent("_click"),e.strictEqual(_currentElement,n,"`_currentElement` is 'el2'"),e.strictEqual(_copyTarget,t,"`_copyTarget` is 'el1'"),e.strictEqual(r.target,t,"`_click` target is 'el1'"),_preprocessEvent(r),e.strictEqual(_currentElement,n,"`_currentElement` is 'el2'"),e.strictEqual(_copyTarget,null,"`_copyTarget` is `null`"),e.strictEqual(r.target,t,"`_click` target is 'el1'"),_currentElement=_copyTarget=t=n=null}),t("`_getRelatedTarget` works",function(e){e.expect(4);var t=$("#relTargetId")[0],n=$("#goodTargetId")[0],r=$("#badTargetId1")[0],i=$("#badTargetId2")[0];e.notEqual(t,null,"The related target is `null`"),e.strictEqual(_getRelatedTarget(n),t,"Element with `data-clipboard-target` returns `null`"),e.strictEqual(_getRelatedTarget(r),null,"Element with `data-clipboard-target` that doesn't much any elements returns `null`"),e.strictEqual(_getRelatedTarget(i),null,"Element without `data-clipboard-target` returns `null`")}),t("`_shouldPerformAsync` works",function(e){e.expect(4),e.strictEqual(_shouldPerformAsync({type:"beforecopy"}),!1,"`beforecopy` should be performed synchronously"),e.strictEqual(_shouldPerformAsync({type:"copy"}),!1,"`copy` should be performed synchronously"),e.strictEqual(_shouldPerformAsync({type:"destroy"}),!1,"`destroy` should be performed synchronously"),e.strictEqual(_shouldPerformAsync({type:"ready"}),!0,"All other event types should be performed asynchronously")}),t("`_dispatchCallback` can fire asynchronously",function(e){e.expect(6);var t=!1,n=!1,r=function(){n=!0},i=!0,s=!1,o=function(){QUnit.start(),e.strictEqual(s,!1),s=!0,e.strictEqual(s,!0)};e.strictEqual(n,!1),_dispatchCallback(r,null,null,t),e.strictEqual(n,!0),e.strictEqual(s,!1),_dispatchCallback(o,null,null,i),e.strictEqual(s,!1),QUnit.stop()}),e("core/private.js unit tests - flash",{setup:function(){i=_flashState,n=window.navigator.mimeTypes["application/x-shockwave-flash"],r=window.ActiveXObject},teardown:function(){window.navigator.mimeTypes["application/x-shockwave-flash"]=n,window.ActiveXObject=r,_flashState=i}}),t("Detecting no Flash",function(e){e.expect(1),window.navigator.mimeTypes["application/x-shockwave-flash"]=undefined,window.ActiveXObject=undefined,_detectFlashSupport(window.ActiveXObject),e.strictEqual(_flashState.disabled,!0)}),t("Detecting has Flash mimetype",function(e){e.expect(1),window.navigator.mimeTypes["application/x-shockwave-flash"]={},window.ActiveXObject=function(){},_detectFlashSupport(window.ActiveXObject),e.strictEqual(_flashState.disabled,!1)})})(QUnit.module,QUnit.test);