(function(e,t){e.formUtils.addValidator({name:"spamcheck",validatorFunction:function(e,t,n){var r=t.valAttr("captcha");return r===e},errorMessage:"",errorMessageKey:"badSecurityAnswer"}),e.formUtils.addValidator({name:"confirmation",validatorFunction:function(e,t,n,r,i){var s="",o=t.valAttr("confirm")||t.attr("name")+"_confirmation",u=i.find('input[name="'+o+'"]').eq(0);return u?s=u.val():alert('Could not find an input with name "'+o+'"'),e===s},errorMessage:"",errorMessageKey:"notConfirmed"});var n={amex:[15,15],diners_club:[14,14],cjb:[16,16],laser:[16,19],visa:[16,16],mastercard:[16,16],maestro:[12,19],discover:[16,16]},r=!1,i=!1;e.formUtils.addValidator({name:"creditcard",validatorFunction:function(s,o,u,a,f){var l=e.split(o.valAttr("allowing")||"");i=e.inArray("amex",l)>-1,r=i&&l.length==1;if(l.length>0){var c=!1;e.each(l,function(e,r){if(r in n){if(s.length>=n[r][0]&&s.length<=n[r][1])return c=!0,!1}else t.console&&console.warn('Use of unknown credit card "'+r+'"')});if(!c)return!1}if(s.replace(new RegExp("[0-9]","g"),"")!=="")return!1;var h=0;return e.each(s.split("").reverse(),function(e,t){t=parseInt(t,10),e%2===0?h+=t:(t*=2,t<10?h+=t:h+=t-9)}),h%10===0},errorMessage:"",errorMessageKey:"badCreditCard"}),e.formUtils.addValidator({name:"cvv",validatorFunction:function(e){return e.replace(/[0-9]/g,"")===""?(e+="",r?e.length==4:i?e.length==3||e.length==4:e.length==3):!1},errorMessage:"",errorMessageKey:"badCVV"}),e.formUtils.addValidator({name:"strength",validatorFunction:function(t,n,r){var i=n.valAttr("strength")||2;return i&&i>3&&(i=3),e.formUtils.validators.validate_strength.calculatePasswordStrength(t)>=i},errorMessage:"",errorMessageKey:"badStrength",calculatePasswordStrength:function(e){if(e.length<4)return 0;var t=0,n=function(e,t){var n="";for(var r=0;r<t.length;r++){var i=!0;for(var s=0;s<e&&s+r+e<t.length;s++)i=i&&t.charAt(s+r)==t.charAt(s+r+e);s<e&&(i=!1),i?(r+=e-1,i=!1):n+=t.charAt(r)}return n};t+=e.length*4,t+=(n(1,e).length-e.length)*1,t+=(n(2,e).length-e.length)*1,t+=(n(3,e).length-e.length)*1,t+=(n(4,e).length-e.length)*1,e.match(/(.*[0-9].*[0-9].*[0-9])/)&&(t+=5),e.match(/(.*[!,@,#,$,%,^,&,*,?,_,~].*[!,@,#,$,%,^,&,*,?,_,~])/)&&(t+=5),e.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)&&(t+=10),e.match(/([a-zA-Z])/)&&e.match(/([0-9])/)&&(t+=15),e.match(/([!,@,#,$,%,^,&,*,?,_,~])/)&&e.match(/([0-9])/)&&(t+=15),e.match(/([!,@,#,$,%,^,&,*,?,_,~])/)&&e.match(/([a-zA-Z])/)&&(t+=15);if(e.match(/^\w+$/)||e.match(/^\d+$/))t-=10;return t<0&&(t=0),t>100&&(t=100),t<20?0:t<40?1:t<=60?2:3},strengthDisplay:function(t,n){var r={fontSize:"12pt",padding:"4px",bad:"Very bad",weak:"Weak",good:"Good",strong:"Strong"};n&&e.extend(r,n),t.bind("keyup",function(){var t=e(this).val(),n=typeof r.parent=="undefined"?e(this).parent():e(r.parent),i=n.find(".strength-meter"),s=e.formUtils.validators.validate_strength.calculatePasswordStrength(t),o={background:"pink",color:"#FF0000",fontWeight:"bold",border:"red solid 1px",borderWidth:"0px 0px 4px",display:"inline-block",fontSize:r.fontSize,padding:r.padding},u=r.bad;i.length==0&&(i=e("<span></span>"),i.addClass("strength-meter").appendTo(n)),t?i.show():i.hide(),s==1?u=r.weak:s==2?(o.background="lightyellow",o.borderColor="yellow",o.color="goldenrod",u=r.good):s>=3&&(o.background="lightgreen",o.borderColor="darkgreen",o.color="darkgreen",u=r.strong),i.css(o).text(u)})}});var s=function(t,n,r,i,s){var o=n.valAttr("req-params")||n.data("validation-req-params")||{},u=function(t,r){t.valid?n.valAttr("backend-valid","true"):(n.valAttr("backend-invalid","true"),t.message&&n.attr(i.validationErrorMsgAttribute,t.message)),n.valAttr("has-keyup-event")||n.valAttr("has-keyup-event","1").bind("keyup change",function(t){t.keyCode!=9&&t.keyCode!=16&&e(this).valAttr("backend-valid",!1).valAttr("backend-invalid",!1)}),r()};o||(o={}),typeof o=="string"&&(o=e.parseJSON(o)),o[n.valAttr("param-name")||n.attr("name")]=r,e.ajax({url:t,type:"POST",cache:!1,data:o,dataType:"json",error:function(e,t){return u({valid:!1,message:"Connection failed with status: "+e.statusText},s),!1},success:function(e){u(e,s)}})},o=function(){return!1};e.formUtils.addValidator({name:"server",validatorFunction:function(t,n,r,i,u){var a=n.valAttr("backend-valid"),f=n.valAttr("backend-invalid"),l=document.location.href;return n.valAttr("url")?l=n.valAttr("url"):"serverURL"in r&&(l=r.backendUrl),a?!0:f?!1:e.formUtils.eventType=="keyup"?null:e.formUtils.isValidatingEntireForm?(u.bind("submit",o).addClass("validating-server-side").addClass("on-blur"),n.addClass("validating-server-side"),e.formUtils.haltValidation=!0,s(l,n,t,r,function(){u.removeClass("validating-server-side").removeClass("on-blur").get(0).onsubmit=function(){},u.unbind("submit",o),n.removeClass("validating-server-side"),n.valAttr("value-length",t.length),e.formUtils.haltValidation=!1,u.trigger("submit")}),null):(u.addClass("validating-server-side"),n.addClass("validating-server-side"),s(l,n,t,r,function(){u.removeClass("validating-server-side"),n.removeClass("validating-server-side"),n.trigger("blur")}),null)},errorMessage:"",errorMessageKey:"badBackend",validateOnKeyUp:!1}),e.fn.displayPasswordStrength=function(t){return new e.formUtils.validators.validate_strength.strengthDisplay(this,t),this}})(jQuery,window);